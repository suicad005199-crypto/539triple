<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 é æ¸¬å“è³ªæ§ç®¡ç³»çµ±</title>
<style>
body { font-family: Arial; padding: 20px; }
table { border-collapse: collapse; }
td, th { border: 1px solid #ccc; padding: 6px; text-align: center; }
.pass { color: green; font-weight: bold; }
.fail { color: red; font-weight: bold; }
</style>
</head>
<body>

<h2>539 ä¸‹æœŸé æ¸¬èˆ‡ â‰¥2 å“è³ªé©—è­‰</h2>
<input type="file" id="csvFile" accept=".csv">
<button onclick="run()">åŸ·è¡Œ</button>

<div id="predict"></div>
<div id="qc"></div>

<script>
function parseCSV(text){
  return text.trim().split('\n').slice(1).map(l=>{
    const p=l.split(',');
    return {date:p[0], nums:p.slice(1).map(Number)};
  });
}

function run(){
  const f=document.getElementById('csvFile').files[0];
  if(!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r=new FileReader();
  r.onload=e=>main(parseCSV(e.target.result));
  r.readAsText(f);
}

function gen3Picks(hist){
  const freq={}, lastSeen={};
  hist.forEach((d,idx)=>d.nums.forEach(n=>{
    freq[n]=(freq[n]||0)+1;
    lastSeen[n]=idx;
  }));

  const hot=Object.keys(freq).filter(n=>freq[n]>=2).map(Number)
    .sort((a,b)=>freq[b]-freq[a]);

  const gap=Object.keys(lastSeen).filter(n=>10-lastSeen[n]>=8).map(Number)
    .sort((a,b)=>(10-lastSeen[b])-(10-lastSeen[a]));

  const base=[...hot.slice(0,5),...gap.slice(0,5)];

  const picks=[];
  for(let i=0;i<3;i++){
    picks.push(base.slice(i,i+5).sort((a,b)=>a-b));
  }
  return picks;
}

function main(data){
  let hit=0, total=0;

  for(let i=10;i<data.length;i++){
    const hist=data.slice(i-10,i);
    const target=data[i].nums;
    const picks=gen3Picks(hist);

    const ok=picks.some(p=>p.filter(n=>target.includes(n)).length>=2);
    if(ok) hit++;
    total++;
  }

  const rate=(hit/total*100).toFixed(1);

  // ä¸‹æœŸ
  const nextPicks=gen3Picks(data.slice(-10));

  document.getElementById('predict').innerHTML=`
  <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ç‰Œçµ„ï¼ˆ3 çµ„ï¼‰</h3>
  ${nextPicks.map(p=>'['+p.join(' ')+']').join('<br>')}
  `;

  document.getElementById('qc').innerHTML=`
  <h3>â‰¥2 é æœŸå‘½ä¸­ç‡é©—è­‰</h3>
  æ­·å²æ¨¡æ“¬ â‰¥2 å‘½ä¸­ç‡ï¼š${rate}%<br>
  ${rate>=70
    ?'<span class="pass">âœ” é€šéï¼ˆå¯å‡ºæ‰‹ï¼‰</span>'
    :'<span class="fail">âœ˜ æœªé€šéï¼ˆæœ¬æœŸä¸å‡ºæ‰‹ï¼‰</span>'}
  `;
}
</script>
</body>
</html>
