<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>539 æ™ºèƒ½åˆ†æç³»çµ± - Pro é‡åŒ–æ±ºç­–ç‰ˆ</title>
<style>
:root {
    --primary: #0f172a; --secondary: #1e293b; --accent: #38bdf8; --gold: #fbbf24;
    --success: #22c55e; --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7);
    --text: #f1f5f9; --glass: rgba(255, 255, 255, 0.03);
}

body { 
    font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; 
    background-color: var(--bg);
    background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
    margin: 0; padding: 20px 15px; color: var(--text); min-height: 100vh; line-height: 1.6;
}

.container { max-width: 1000px; margin: 0 auto; }
header { text-align: center; margin-bottom: 30px; padding: 10px 0; }
header h1 { font-size: 2.2rem; margin: 0; color: var(--accent); font-weight: 900; text-shadow: 0 0 20px rgba(56, 189, 248, 0.3); letter-spacing: 2px; }
header p { font-size: 0.85rem; margin: 8px 0 0; opacity: 0.5; letter-spacing: 3px; font-weight: 300; }

.card { background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); padding: 24px; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); margin-bottom: 25px; }
.upload-section { border: 2px dashed rgba(56, 189, 248, 0.2); transition: 0.3s; padding: 40px 20px; text-align: center; }

button { 
    background: linear-gradient(135deg, var(--accent), #0284c7); color: white; border: none; padding: 16px 30px; 
    border-radius: 14px; font-weight: 800; font-size: 1.1rem; cursor: pointer; transition: 0.3s; width: 100%;
}
button:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(56, 189, 248, 0.5); }

.dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
@media (min-width: 768px) { .dashboard-grid { grid-template-columns: 1fr 1fr; } }

h3 { font-size: 1.2rem; margin-top: 0; margin-bottom: 20px; color: var(--gold); display: flex; align-items: center; font-weight: 700; }
h3::before { content: ''; display: inline-block; width: 4px; height: 20px; background: var(--gold); margin-right: 12px; border-radius: 2px; }

table { width: 100%; border-collapse: collapse; }
td { padding: 15px 5px; border-bottom: 1px solid rgba(255,255,255,0.03); text-align: center; }

.ball { 
    display: inline-block; width: 38px; height: 38px; line-height: 38px; text-align: center; border-radius: 50%; 
    background: radial-gradient(circle at 30% 30%, #475569, #1e293b); margin: 4px; font-weight: 800; font-size: 16px; color: var(--accent);
}

.resonance-card { background: linear-gradient(145deg, rgba(56, 189, 248, 0.15), rgba(15, 23, 42, 0.8)); border: 1px solid var(--accent); }

.strategy-block { background: var(--glass); padding: 20px; margin: 15px 0; border-radius: 18px; border-left: 4px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.3s; }
.strategy-block:hover { background: rgba(255,255,255,0.08); }
.strategy-block.active { border-left-color: var(--success); }

.logic-detail { display: none; margin-top: 15px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 12px; font-size: 0.85rem; color: #cbd5e1; }
.rate-badge { font-size: 0.7rem; padding: 5px 12px; border-radius: 20px; background: rgba(56, 189, 248, 0.15); color: var(--accent); font-weight: bold; }

.inline-input { width: 60px; height: 60px; text-align: center; margin: 0 5px; border: 2px solid rgba(255,255,255,0.1); border-radius: 16px; font-size: 1.4rem; font-weight: 900; background: #0f172a; color: var(--gold); }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <header><h1>539 QUANT PRO</h1><p>CONVERGENCE ANALYSIS â€¢ 500 SIMS</p></header>

    <div class="card upload-section">
        <input type="file" id="csvFile" accept=".csv" style="display: none;">
        <label for="csvFile" id="fileLabel" style="display: block; padding: 15px; background: var(--secondary); border-radius: 10px; cursor: pointer; margin-bottom: 20px; color: #94a3b8;">é»æ“Šé¸å–æ­·å²æ•¸æ“š CSV</label>
        <button onclick="runAll()">å•Ÿå‹• 500 æ¬¡æ”¶æ–‚åˆ†æ</button>
    </div>

    <div class="dashboard-grid">
        <div id="history" class="card"><h3>è¿‘æœŸé–‹çæ­·å²</h3></div>
        <div id="stats_table" class="card"><h3>ç­–ç•¥å›æ¸¬è¡¨ç¾</h3></div>
    </div>

    <div id="results" class="card">
        <h3>æ™ºèƒ½æ¨èçµ„åˆ</h3>
        <div style="text-align: center; padding: 40px; opacity: 0.3;">ç­‰å¾…æ•¸æ“šåŸ·è¡Œ...</div>
    </div>

    <div class="card">
        <h3>è‡ªé¸è™Ÿç¢¼é©—è­‰</h3>
        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 25px;">
            <input type="number" class="inline-input" id="userNum1" placeholder="01">
            <input type="number" class="inline-input" id="userNum2" placeholder="02">
            <input type="number" class="inline-input" id="userNum3" placeholder="03">
            <input type="number" class="inline-input" id="userNum4" placeholder="04">
            <input type="number" class="inline-input" id="userNum5" placeholder="05">
        </div>
        <button onclick="verifyUserPick()" style="background: transparent; border: 2px solid var(--accent); color: var(--accent);">é©—è­‰æ­·å²å‘½ä¸­æ½›åŠ›</button>
        <div id="userPickResult" style="margin-top:25px;"></div>
    </div>
</div>

<script>
let HIST_DATA = [];
const RULES = [
    { name: "ä¿å®ˆå‹ç­–ç•¥", pool: "last1+5", desc: "é–å®šä¸ŠæœŸè™Ÿç¢¼èˆ‡é—œè¯è·¯å¾‘", logic: "é »ç‡åŠ æ¬Š 60%" },
    { name: "å¹³è¡¡å‹ç­–ç•¥", pool: "last5+5+10", desc: "æƒæè¿‘ 5 æœŸè¶¨å‹¢è™Ÿç¢¼", logic: "éºæ¼ä¿®æ­£ 40%" },
    { name: "æ¿€é€²å‹ç­–ç•¥", pool: "last5+10", desc: "æ•æ‰å¤§è·¨åº¦è·³èºç‰ˆè·¯", logic: "é—œè¯çŸ©é™£ 50%" }
];

async function runAll(){
    const file = document.getElementById("csvFile").files[0];
    if(!file) return alert("è«‹å…ˆé¸å– CSV");
    const text = await file.text();
    HIST_DATA = parseCSV(text);
    showHistory(HIST_DATA);
    renderResults(HIST_DATA);
}

function parseCSV(text){
    return text.trim().split("\n").slice(1).map(l => {
        const p = l.split(",");
        return {date: p[0], nums: p.slice(2, 7).map(n => parseInt(n)).sort((a,b)=>a-b)};
    }).filter(x => !isNaN(x.nums[0]));
}

function renderResults(data) {
    const resArea = document.getElementById("results");
    resArea.innerHTML = "";

    // å•Ÿå‹• 500 æ¬¡æ¨¡æ“¬æ”¶æ–‚çµ±è¨ˆ
    const globalFreq = {};
    for(let i=0; i<500; i++) {
        RULES.forEach(r => {
            const pick = generateSmartPick(data, r, 1);
            pick.forEach(n => globalFreq[n] = (globalFreq[n] || 0) + 1);
        });
    }

    const resonantNums = Object.entries(globalFreq).sort((a,b)=>b[1]-a[1]).slice(0,5).map(i=>i[0]).sort((a,b)=>a-b);

    // æ ¸å¿ƒå…±é³´
    const resCard = document.createElement("div");
    resCard.className = "card resonance-card";
    resCard.innerHTML = `
        <h3 style="color:var(--gold)">ğŸ¯ æ ¸å¿ƒå…±é³´è™Ÿç¢¼ (500æ¬¡æ”¶æ–‚)</h3>
        <p style="font-size:0.75rem; opacity:0.8; margin-top:-10px">é€™æ˜¯å¤§æ•¸æ“šæ”¶æ–‚å¾Œçš„æœ€é«˜æ©Ÿç‡å…¬ç´„æ•¸ï¼Œæ¥µåº¦ç©©å®šã€‚</p>
        <div style="text-align:center;">
            ${resonantNums.map(n => `<span class="ball" style="background:var(--gold); color:#000">${String(n).padStart(2,'0')}</span>`).join("")}
        </div>
    `;
    resArea.appendChild(resCard);

    // ç­–ç•¥çµ„
    RULES.forEach((r, idx) => {
        const pick = generateSmartPick(data, r, 100);
        const ev = calculateEV(pick, data.slice(-60));
        const block = document.createElement("div");
        block.className = "strategy-block active";
        block.onclick = () => { const d = document.getElementById(`d-${idx}`); d.style.display = d.style.display==='block'?'none':'block'; };
        block.innerHTML = `
            <div style="display:flex; justify-content:space-between">
                <span style="color:var(--accent); font-weight:bold">${r.name} â–¾</span>
                <span class="rate-badge">æ½›åŠ›: ${(ev*100).toFixed(1)}</span>
            </div>
            <div style="text-align:center; margin-top:10px">${pick.map(n => `<span class="ball">${String(n).padStart(2,'0')}</span>`).join("")}</div>
            <div id="d-${idx}" class="logic-detail"><strong>é‚è¼¯ï¼š</strong>${r.desc}<br><strong>æ¬Šé‡ï¼š</strong>${r.logic}</div>`;
        resArea.appendChild(block);
    });
}

function generateSmartPick(prev, rule, sims) {
    const pool = new Set();
    const lastNums = prev[prev.length - 1].nums;
    if(rule.pool.includes("last1")) lastNums.forEach(n => pool.add(n));
    if(rule.pool.includes("last5")) prev.slice(-5).forEach(d => d.nums.forEach(n => pool.add(n)));
    [...pool].forEach(n => {
        if(rule.pool.includes("+5") && n+5 <= 39) pool.add(n+5);
        if(rule.pool.includes("+10") && n+10 <= 39) pool.add(n+10);
    });
    
    const freq = {}; prev.forEach(d => d.nums.forEach(n => freq[n] = (freq[n]||0)+1));
    let candidates = [];
    for(let i=0; i<sims; i++) {
        let arr = [...pool];
        arr.sort((a,b) => (freq[b]||0) - (freq[a]||0) + (Math.random()*6-3));
        candidates.push(arr.slice(0,5).sort((a,b)=>a-b));
    }
    return candidates[0];
}

function calculateEV(pick, testData) {
    const hits = testData.filter(d => d.nums.filter(n => pick.includes(n)).length >= 2).length;
    return hits / testData.length;
}

function showHistory(data){
    document.getElementById("history").innerHTML = "<h3>è¿‘æœŸé–‹çæ­·å²</h3><table>" + 
    data.slice(-5).reverse().map(d => `<tr><td>${d.date.slice(5)}</td><td>${d.nums.map(n=>`<span class="ball">${String(n).padStart(2,'0')}</span>`).join("")}</td></tr>`).join("") + "</table>";
}

function verifyUserPick() {
    const p = [1,2,3,4,5].map(i => parseInt(document.getElementById("userNum"+i).value)).filter(n => n>0);
    let h2=0, h3=0;
    HIST_DATA.forEach(d => {
        const m = d.nums.filter(n => p.includes(n)).length;
        if(m===2) h2++; if(m===3) h3++;
    });
    document.getElementById("userPickResult").innerHTML = `æ­·å²äºŒæ˜Ÿ: ${h2} æ¬¡ | ä¸‰æ˜Ÿ: ${h3} æ¬¡`;
}
</script>
</body>
</html>
