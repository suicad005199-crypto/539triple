<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 å¹³è¡¡å‹ç­–ç•¥å›æ¸¬èˆ‡é æ¸¬</title>
<style>
body { font-family: Arial; padding: 20px; }
table { border-collapse: collapse; margin-top: 12px; font-size: 13px; }
td, th { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
.hit2 { background:#e0f5e0; }
.hit3 { background:#9fe29f; font-weight:bold; }
.hit4 { background:#ffd54f; font-weight:bold; }
</style>
</head>
<body>

<h2>539 å¹³è¡¡å‹ç­–ç•¥ç³»çµ±ï¼ˆè·¯ç·š Bï¼‰</h2>

<input type="file" id="csvFile" accept=".csv">
<button onclick="run()">åŸ·è¡Œå›æ¸¬</button>

<div id="summary"></div>
<div id="next"></div>
<div id="log"></div>

<script>
function parseCSV(text) {
  return text.trim().split('\n').slice(1).map(l => {
    const p = l.split(',');
    return { date: p[0], nums: p.slice(1).map(Number) };
  });
}

function run() {
  const f = document.getElementById('csvFile').files[0];
  if (!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r = new FileReader();
  r.onload = e => simulate(parseCSV(e.target.result));
  r.readAsText(f);
}

function buildPicks(hist, fullData, idx) {
  const freq = {};
  hist.forEach(d => d.nums.forEach(n => freq[n] = (freq[n] || 0) + 1));

  const hot = Object.keys(freq)
    .filter(n => freq[n] >= 2)
    .map(Number)
    .sort((a,b) => freq[b]-freq[a]);

  const lastSeen = {};
  fullData.slice(0, idx).forEach((d,i) => d.nums.forEach(n => lastSeen[n]=i));

  const gap = Object.keys(lastSeen)
    .map(Number)
    .sort((a,b)=>(idx-lastSeen[b])-(idx-lastSeen[a]));

  const pool = [...new Set([
    ...hot.slice(0,6),
    ...gap.slice(0,6),
    ...hot.slice(6,8)
  ])].filter(n=>n>=1&&n<=39);

  // è§’è‰²åˆ†å·¥ 5 çµ„ï¼ˆdeterministicï¼‰
  return [
    pool.slice(0,5),
    pool.slice(1,6),
    pool.slice(2,7),
    [pool[0],pool[2],pool[4],pool[6],pool[8]].filter(n=>n!==undefined),
    [pool[1],pool[3],pool[5],pool[7],pool[9]].filter(n=>n!==undefined)
  ].map(p=>p.sort((a,b)=>a-b));
}

function simulate(data) {
  let hit2=0, hit3=0, hit4=0;
  let rows='';

  for (let i=10;i<data.length;i++) {
    const hist=data.slice(i-10,i);
    const target=data[i].nums;
    const picks=buildPicks(hist,data,i);

    let best=0;
    picks.forEach(p=>{
      const h=p.filter(n=>target.includes(n)).length;
      best=Math.max(best,h);
    });

    if (best>=2) hit2++;
    if (best>=3) hit3++;
    if (best>=4) hit4++;

    rows+=`<tr class="${best>=4?'hit4':best>=3?'hit3':best>=2?'hit2':''}">
      <td>${data[i].date}</td>
      <td>${best}</td>
      <td>${picks.map(p=>'['+p.join(' ')+']').join('<br>')}</td>
    </tr>`;
  }

  const total=data.length-10;
  document.getElementById('summary').innerHTML=`
    <h3>å›æ¸¬çµæœ</h3>
    å¯å›æ¸¬æœŸæ•¸ï¼š${total}<br>
    å‡ºæ‰‹æœŸæ•¸ï¼š${total}<br>
    â‰¥2 å‘½ä¸­ç‡ï¼š${(hit2/total*100).toFixed(1)}%<br>
    â‰¥3 å‘½ä¸­ç‡ï¼š${(hit3/total*100).toFixed(1)}%<br>
    â‰¥4 å‘½ä¸­ç‡ï¼š${(hit4/total*100).toFixed(1)}%
  `;

  document.getElementById('log').innerHTML=
    `<table>
      <tr><th>æ—¥æœŸ</th><th>æœ€é«˜å‘½ä¸­</th><th>å‡ºæ‰‹ 5 çµ„</th></tr>
      ${rows}
    </table>`;

  predictNext(data);
}

function predictNext(data){
  const hist=data.slice(-10);
  const picks=buildPicks(hist,data,data.length);

  document.getElementById('next').innerHTML=`
    <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ç‰Œçµ„ï¼ˆ5 çµ„ï½œå¹³è¡¡å‹ï¼‰</h3>
    ${picks.map((p,i)=>`çµ„${i+1}ï¼š[${p.join(' ')}]`).join('<br>')}
  `;
}
</script>
</body>
</html>
