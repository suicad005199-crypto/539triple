<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ä»Šå½© 539 æ•¸æ“šåˆ†æå™¨</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; max-width: 900px; margin: 20px auto; background: #f0f2f5; color: #333; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .upload-section { border: 2px dashed #3498db; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 20px; }
        .btn { background: #3498db; color: white; border: none; padding: 10px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #2980b9; }
        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; display: none; }
        .card { border: 1px solid #eee; padding: 15px; border-radius: 8px; background: #fff; }
        .num-ball { display: inline-block; width: 40px; height: 40px; line-height: 40px; background: #e74c3c; color: white; border-radius: 50%; margin: 5px; text-align: center; font-weight: bold; font-size: 18px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #f8f9fa; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¯ çè™Ÿåˆ†æèˆ‡ä¸‹æœŸé æ¸¬</h2>
    <div class="upload-section">
        <input type="file" id="csvFile" accept=".csv">
        <button class="btn" onclick="analyzeCSV()">ä¸Šå‚³ä¸¦åˆ†æ</button>
    </div>

    <div id="resultArea" class="result-grid">
        <div class="card" style="grid-column: 1 / -1; text-align: center;">
            <h3>ğŸ”® ä¸‹æœŸæ¨è–¦è™Ÿç¢¼ (åŸºæ–¼è¿‘æœŸæ¬Šé‡)</h3>
            <div id="prediction"></div>
        </div>

        <div class="card">
            <h3>ğŸ“ˆ æ­·å²ç†±é–€æ’è¡Œæ¦œ (å‰ 10 å)</h3>
            <div id="hotStats"></div>
        </div>

        <div class="card">
            <h3>â³ éºæ¼åˆ†æ (æœ€ä¹…æœªå‡ºç¾)</h3>
            <div id="coldStats"></div>
        </div>
    </div>
</div>

<script>
function analyzeCSV() {
    const file = document.getElementById('csvFile').files[0];
    if (!file) return alert("è«‹é¸æ“‡ CSV æª”æ¡ˆ");

    const reader = new FileReader();
    reader.onload = function(e) {
        const rows = e.target.result.split('\n')
            .map(row => row.split(',').map(cell => cell.trim()))
            .filter(row => row.length >= 6 && !isNaN(parseInt(row[1])));

        processNumbers(rows);
    };
    reader.readAsText(file);
}

function processNumbers(data) {
    let freq = {}; // ç¸½é »ç‡
    let lastSeen = {}; // æœ€å¾Œå‡ºç¾ä½ç½®
    let totalRows = data.length;

    // åˆå§‹åŒ– 1-39 è™Ÿ (å‡è¨­ç‚º 539)
    for (let i = 1; i <= 39; i++) {
        freq[i] = 0;
        lastSeen[i] = -1;
    }

    // è¶Šå¾€ä¸‹è³‡æ–™è¶Šæ–°ï¼Œæ•… index è¶Šå¤§æ¬Šé‡è¶Šé«˜
    let weightedPool = [];
    
    data.forEach((row, idx) => {
        for (let i = 1; i <= 5; i++) {
            let num = parseInt(row[i]);
            if (!isNaN(num)) {
                freq[num]++;
                lastSeen[num] = idx;
                // æ¬Šé‡è¨­è¨ˆï¼šè¿‘æœŸå‡ºç¾çš„è™Ÿç¢¼å¢åŠ é€²å…¥éš¨æ©Ÿæ± çš„æ¬¡æ•¸
                let weight = Math.floor((idx / totalRows) * 10) + 1;
                for(let w=0; w<weight; w++) weightedPool.push(num);
            }
        }
    });

    displayStats(freq, lastSeen, totalRows, weightedPool);
}

function displayStats(freq, lastSeen, totalRows, pool) {
    document.getElementById('resultArea').style.display = 'grid';

    // 1. ç”Ÿæˆé æ¸¬è™Ÿç¢¼ (éš¨æ©Ÿå– 5 å€‹ä¸é‡è¤‡)
    let pred = new Set();
    while(pred.size < 5) {
        let n = pool[Math.floor(Math.random() * pool.length)];
        pred.add(n);
    }
    const sortedPred = Array.from(pred).sort((a,b) => a-b);
    document.getElementById('prediction').innerHTML = 
        sortedPred.map(n => `<span class="num-ball">${n}</span>`).join('');

    // 2. ç†±é–€æ’è¡Œæ¦œ
    const hotSorted = Object.entries(freq).sort((a,b) => b[1] - a[1]).slice(0, 10);
    let hotHtml = '<table><tr><th>è™Ÿç¢¼</th><th>æ¬¡æ•¸</th></tr>';
    hotSorted.forEach(item => {
        hotHtml += `<tr><td>${item[0]}</td><td>${item[1]}</td></tr>`;
    });
    document.getElementById('hotStats').innerHTML = hotHtml + '</table>';

    // 3. éºæ¼åˆ†æ
    const coldSorted = Object.entries(lastSeen)
        .sort((a,b) => a[1] - b[1]).slice(0, 10);
    let coldHtml = '<table><tr><th>è™Ÿç¢¼</th><th>æœªé–‹æœŸæ•¸</th></tr>';
    coldSorted.forEach(item => {
        let missed = totalRows - 1 - item[1];
        coldHtml += `<tr><td>${item[0]}</td><td>${missed} æœŸ</td></tr>`;
    });
    document.getElementById('coldStats').innerHTML = coldHtml + '</table>';
}
</script>

</body>
</html>
