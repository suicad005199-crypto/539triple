<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>539 智能分析系統 - 多策略推薦</title>
<style>
:root {
    --primary: #0f172a;
    --secondary: #1e293b;
    --accent: #38bdf8;
    --gold: #fbbf24;
    --text: #f1f5f9;
    --card-bg: rgba(30,41,59,0.7);
}

body {
    font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
    background-color: var(--primary);
    color: var(--text);
    margin: 0; padding: 20px;
    min-height: 100vh; line-height: 1.6;
}

.container { max-width: 1000px; margin: 0 auto; }

header { text-align:center; margin-bottom:30px;}
header h1 { color: var(--accent); font-size:2.2rem; margin:0; font-weight:900; text-shadow:0 0 20px rgba(56,189,248,0.3);}
header p { opacity:0.6; font-size:0.85rem; margin:8px 0 0;}

.card {
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 25px;
}

.upload-section { border: 2px dashed rgba(56,189,248,0.2); padding:40px 20px; text-align:center; cursor:pointer;}
.upload-section:hover { border-color: var(--accent); background: rgba(56,189,248,0.05); }

button {
    width:100%; padding:16px; margin-top:10px;
    border:none; border-radius:14px;
    font-weight:800; font-size:1.1rem;
    background: linear-gradient(135deg, var(--accent), #0284c7);
    color:white; cursor:pointer; transition:0.3s;
}
button:hover { transform: translateY(-3px); box-shadow:0 8px 25px rgba(56,189,248,0.5); }

.ball {
    display:inline-block; width:38px; height:38px; line-height:38px;
    border-radius:50%; background: radial-gradient(circle at 30% 30%, #475569, #1e293b);
    margin:4px; font-weight:800; font-size:16px; color: var(--accent);
    text-align:center;
}

.strategy-block h3 { color: var(--gold); margin-bottom:15px; }
.strategy-block { margin-bottom:25px; }
.result-line { margin-bottom:8px; }
.result-line span { margin-left:10px; font-size:0.9rem; opacity:0.8; }
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>539 QUANT PRO</h1>
        <p>多策略智能推薦 • 歷史數據分析</p>
    </header>

    <div class="card upload-section" id="uploadSection">
        <input type="file" id="csvFile" accept=".csv" style="display:none;">
        <label for="csvFile" id="fileLabel">點擊選取歷史數據 CSV</label>
        <button onclick="runAll()">執行策略分析</button>
    </div>

    <div id="history" class="card"><h3>近期開獎歷史</h3></div>

    <div id="strategies" class="container"></div>

</div>

<script>
let HIST_DATA = [];

// 上傳文件名稱顯示
document.getElementById('csvFile').addEventListener('change', function(e){
    const name = e.target.files[0] ? e.target.files[0].name : "點擊選取歷史數據 CSV";
    document.getElementById('fileLabel').innerText = name;
});

// 主要執行
async function runAll(){
    const fileInput = document.getElementById("csvFile");
    if(!fileInput.files[0]){ alert("請先選取 CSV 檔案"); return; }

    const text = await fileInput.files[0].text();
    HIST_DATA = parseCSV(text);
    if(HIST_DATA.length === 0){ alert("CSV 解析失敗"); return; }

    showHistory(HIST_DATA);
    generateAllStrategies(HIST_DATA);
}

// CSV解析
function parseCSV(text){
    const lines = text.trim().split(/\r?\n/);
    lines.shift(); // 移除標題
    return lines.map(l=>{
        const p = l.split(",");
        if(p.length<6) return null;
        const nums = p.slice(1,6).map(n=>parseInt(n.trim())).sort((a,b)=>a-b);
        if(nums.some(isNaN)) return null;
        return { date:p[0].trim(), nums: nums };
    }).filter(x=>x!==null).sort((a,b)=> new Date(a.date)-new Date(b.date));
}

// 顯示歷史
function showHistory(data){
    let html = "<table>";
    data.slice(-5).reverse().forEach(d=>{
        html += `<tr><td style='opacity:0.6; font-size:0.8rem;'>${d.date}</td><td>${d.nums.map(n=>`<span class='ball'>${String(n).padStart(2,'0')}</span>`).join("")}</td></tr>`;
    });
    html += "</table>";
    document.getElementById("history").innerHTML = "<h3>近期開獎歷史</h3>"+html;
}

// 生成所有策略
function generateAllStrategies(data){
    const container = document.getElementById("strategies");
    container.innerHTML = "";

    const strategies = [
        {name:"熱號策略", func: generateHotStrategy},
        {name:"冷熱混合策略", func: generateMixedStrategy},
        {name:"掉落號策略", func: generateDropStrategy}
    ];

    strategies.forEach(s=>{
        const block = document.createElement("div");
        block.className = "card strategy-block";
        block.innerHTML = `<h3>${s.name}</h3>`;
        const resultsDiv = document.createElement("div");

        // 每個策略生成3組號碼
        for(let i=0;i<3;i++){
            const nums = s.func(data);
            const rates = simulateHitRate(nums,data);
            const line = document.createElement("div");
            line.className = "result-line";
            line.innerHTML = `${nums.map(n=>`<span class="ball">${String(n).padStart(2,'0')}</span>`).join("")}
                              <span>2★:${rates[2]}% 3★:${rates[3]}% 4★:${rates[4]}% 5★:${rates[5]}%</span>`;
            resultsDiv.appendChild(line);
        }

        block.appendChild(resultsDiv);
        container.appendChild(block);
    });
}

// 模擬勝率
function simulateHitRate(nums,data){
    const hits = {2:0,3:0,4:0,5:0};
    const last50 = data.slice(-50);
    last50.forEach(d=>{
        let match = nums.filter(n=>d.nums.includes(n)).length;
        if(match>=2) hits[match]++;
    });
    // 百分比
    for(let k in hits) hits[k] = ((hits[k]/last50.length)*100).toFixed(1);
    return hits;
}

// 策略生成函數
function generateHotStrategy(data){
    // 取最近50期頻率最高5個號
    const freq = {};
    data.slice(-50).forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
    const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]).map(x=>parseInt(x[0])).slice(0,5);
    return shuffle(sorted).slice(0,5);
}

function generateMixedStrategy(data){
    const freq = {};
    data.slice(-50).forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
    const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]).map(x=>parseInt(x[0]));
    const hot = sorted.slice(0,3);
    const cold = sorted.slice(-2);
    return shuffle(hot.concat(cold));
}

function generateDropStrategy(data){
    if(data.length<2) return generateHotStrategy(data);
    const lastNums = data[data.length-1].nums;
    const last50 = data.slice(-50).flatMap(d=>d.nums);
    const drop = lastNums.filter(n=>!last50.includes(n));
    let result = drop.slice(0,3);
    while(result.length<5) result.push(Math.floor(Math.random()*39)+1);
    return shuffle(result.slice(0,5));
}

// 洗牌
function shuffle(array){
    return array.sort(()=>Math.random()-0.5);
}

</script>
</body>
</html>
