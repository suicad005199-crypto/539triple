<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CSV 號碼分析與預測工具</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: #f9f9f9;
  padding: 20px;
}
h1, h2 {
  text-align: center;
}
input[type="file"], input[type="number"] {
  display: block;
  margin: 10px auto;
  font-size: 18px;
  width: 80%;
}
button {
  display: block;
  margin: 15px auto;
  padding: 12px 25px;
  font-size: 18px;
  border: none;
  background-color: #007AFF;
  color: white;
  border-radius: 10px;
}
#result {
  margin-top: 20px;
  font-size: 18px;
  line-height: 1.6;
}
.number-box {
  display: inline-block;
  margin: 5px;
  padding: 10px 15px;
  border-radius: 50%;
  background-color: #FFD700;
  color: #000;
  font-weight: bold;
  font-size: 20px;
  width: 45px;
  text-align: center;
}
</style>
</head>
<body>

<h1>CSV 號碼分析與預測工具</h1>
<p style="text-align:center;">手動輸入五個號碼，分析規則後生成下一組預測號碼</p>

<div style="text-align:center;">
  <input type="number" id="num1" placeholder="號碼 1" min="1" max="39">
  <input type="number" id="num2" placeholder="號碼 2" min="1" max="39">
  <input type="number" id="num3" placeholder="號碼 3" min="1" max="39">
  <input type="number" id="num4" placeholder="號碼 4" min="1" max="39">
  <input type="number" id="num5" placeholder="號碼 5" min="1" max="39">
</div>

<input type="file" id="csvFile" accept=".csv">
<button id="analyzeBtn">分析規則 & 生成預測號碼</button>

<div id="result"></div>

<script>
// 解析 CSV
function parseCSV(text) {
  const rows = text.trim().split(/\r?\n/);
  const data = [];
  rows.slice(1).forEach(row => {
    const cols = row.split(',');
    const nums = cols.slice(1).map(n => parseInt(n.trim())).filter(n => !isNaN(n));
    data.push(nums);
  });
  return data;
}

// 計算最近 N 天出現次數
function getRecentNumbers(data, days=15) {
  const recent = {};
  const start = Math.max(0, data.length - days);
  for(let i=start;i<data.length;i++){
    data[i].forEach(n=> recent[n]=(recent[n]||0)+1);
  }
  return recent;
}

// 依據規則生成下一組號碼
function predictNumbers(data) {
  const ranges = [
    [1,10],
    [11,20],
    [21,30],
    [31,39]
  ];

  const recent = getRecentNumbers(data,15);
  const nextNumbers = [];

  ranges.forEach(range=>{
    const [min,max] = range;
    const candidates = [];
    for(let i=min;i<=max;i++){
      candidates.push({num:i, recentCount: recent[i]||0});
    }
    // 優先選最近出現過的號碼，若無則隨機
    candidates.sort((a,b)=>b.recentCount - a.recentCount);
    const top = candidates.filter(c=>c.recentCount===candidates[0].recentCount);
    const chosen = top[Math.floor(Math.random()*top.length)];
    nextNumbers.push(chosen.num);
  });

  // 補足成五個號碼
  while(nextNumbers.length<5){
    const remaining = [];
    for(let i=1;i<=39;i++){
      if(!nextNumbers.includes(i)) remaining.push({num:i,recentCount: recent[i]||0});
    }
    remaining.sort((a,b)=>b.recentCount - a.recentCount);
    const top = remaining.filter(c=>c.recentCount===remaining[0].recentCount);
    const chosen = top[Math.floor(Math.random()*top.length)];
    nextNumbers.push(chosen.num);
  }

  return nextNumbers;
}

// 顯示結果
function displayResult(inputNumbers,predictedNumbers,data){
  const resultDiv = document.getElementById('result');
  let html = `<h2>輸入號碼</h2><div>`;
  inputNumbers.forEach(n=>html+=`<span class="number-box">${n}</span>`);
  html += `</div>`;

  html += `<h2>下一組預測號碼</h2><div>`;
  predictedNumbers.forEach(n=>html+=`<span class="number-box">${n}</span>`);
  html += `</div>`;

  // 分析規則
  const recent = getRecentNumbers(data,15);
  html += `<h2>規則分析</h2><ul>`;
  inputNumbers.forEach(n=>{
    const range = n<=10?"1-10":n<=20?"11-20":n<=30?"21-30":"31-39";
    const count = recent[n]||0;
    html += `<li>號碼 ${n} → 區間 ${range}，最近 15 天出現 ${count} 次</li>`;
  });
  html += "</ul>";

  resultDiv.innerHTML = html;
}

document.getElementById('analyzeBtn').addEventListener('click',()=>{
  const nums = [
    parseInt(document.getElementById('num1').value),
    parseInt(document.getElementById('num2').value),
    parseInt(document.getElementById('num3').value),
    parseInt(document.getElementById('num4').value),
    parseInt(document.getElementById('num5').value)
  ];
  if(nums.some(n=>isNaN(n)||n<1||n>39)){
    alert("請輸入 1-39 的五個號碼");
    return;
  }

  const fileInput = document.getElementById('csvFile');
  const file = fileInput.files[0];
  if(!file){
    alert("請先上傳 CSV 檔案");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e){
    const text = e.target.result;
    const data = parseCSV(text);
    const predicted = predictNumbers(data);
    displayResult(nums,predicted,data);
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
