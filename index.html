<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸‰æ˜Ÿ-é æ¸¬ç³»çµ± v3.0</title>
<style>
:root {
  --primary: #00ff99;
  --primary-dark: #00cc7a;
  --secondary: #274c77;
  --secondary-light: #1a3a5f;
  --danger: #ff6666;
  --warning: #ffcc00;
  --info: #4fc3f7;
  --success: #00ff99;
  --bg-0: #050b15;
  --bg-1: #0f1f38;
  --bg-2: #142b4d;
  --bg-3: #1a355c;
  --bg-4: #203f6e;
  --text-light: #e0f7ff;
  --text-muted: #8da1b9;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft JhengHei', sans-serif;
  background: linear-gradient(135deg, #0b1626, #051122);
  color: var(--text-light);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
.header {
  text-align: center;
  padding: 30px 0;
  background: linear-gradient(90deg, var(--bg-0), var(--bg-1));
  border-radius: 20px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(0, 255, 153, 0.1);
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--warning));
}

.header h1 {
  font-size: 2.5rem;
  color: var(--primary);
  margin-bottom: 10px;
  text-shadow: 0 0 20px rgba(0, 255, 153, 0.3);
  font-weight: 700;
}

.subtitle {
  color: var(--text-muted);
  font-size: 1.1rem;
  letter-spacing: 0.5px;
}

/* Panels */
.panel {
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
  backdrop-filter: blur(10px);
}

.panel:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

.panel-0 { background: var(--bg-0); }
.panel-1 { background: var(--bg-1); }
.panel-2 { background: var(--bg-2); }
.panel-3 { background: var(--bg-3); }
.panel-4 { background: var(--bg-4); }

.panel h2 {
  font-size: 1.4rem;
  color: var(--primary);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.panel h2::before {
  content: '';
  width: 6px;
  height: 24px;
  background: var(--primary);
  border-radius: 3px;
}

/* Form Elements */
.file-input-wrapper {
  position: relative;
  margin-bottom: 15px;
}

.file-input {
  width: 100%;
  padding: 16px;
  border: 2px dashed rgba(0, 255, 153, 0.3);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.file-input:hover {
  border-color: var(--primary);
  background: rgba(0, 255, 153, 0.05);
}

.file-input::file-selector-button {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: var(--bg-0);
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  margin-right: 15px;
  transition: transform 0.2s ease;
}

.file-input::file-selector-button:hover {
  transform: translateY(-2px);
}

.text-input {
  width: 100%;
  padding: 16px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  font-size: 16px;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

.text-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 255, 153, 0.1);
}

.btn {
  padding: 16px 24px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
  color: white;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  letter-spacing: 0.5px;
}

.btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.6s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(39, 76, 119, 0.4);
}

.btn:hover::after {
  left: 100%;
}

.btn:active {
  transform: translateY(0);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
}

.btn-group {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin-top: 15px;
}

/* Boxes */
.box {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

.box:hover {
  border-color: rgba(0, 255, 153, 0.1);
}

.box-title {
  color: var(--primary);
  font-size: 1.1rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

/* Numbers Display */
.numbers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  gap: 12px;
  margin: 15px 0;
}

.number-ball {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  font-weight: bold;
  background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
  color: white;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  cursor: pointer;
  user-select: none;
}

.number-ball.hot {
  background: linear-gradient(135deg, #ff6666, #cc0000);
}

.number-ball.cold {
  background: linear-gradient(135deg, var(--info), #0288d1);
}

.number-ball.warm {
  background: linear-gradient(135deg, #ff9900, #cc6600);
}

.number-ball.missed {
  background: linear-gradient(135deg, #ffcc00, #cc9900);
}

.number-ball.selected {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(0, 255, 153, 0.5);
}

.number-ball:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
}

/* Stats */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin: 15px 0;
}

.stat-item {
  background: rgba(255, 255, 255, 0.05);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  transition: all 0.3s ease;
}

.stat-item:hover {
  background: rgba(255, 255, 255, 0.08);
  transform: translateY(-2px);
}

.stat-label {
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-bottom: 8px;
  font-weight: 500;
}

.stat-value {
  color: var(--primary);
  font-size: 1.4rem;
  font-weight: bold;
}

/* Status Messages */
.status {
  padding: 12px 16px;
  border-radius: 8px;
  margin: 10px 0;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.95rem;
  border-left: 4px solid transparent;
}

.status.success {
  background: rgba(0, 255, 153, 0.1);
  border-left-color: var(--primary);
  color: var(--primary);
}

.status.warning {
  background: rgba(255, 204, 0, 0.1);
  border-left-color: var(--warning);
  color: var(--warning);
}

.status.error {
  background: rgba(255, 102, 102, 0.1);
  border-left-color: var(--danger);
  color: var(--danger);
}

.status.info {
  background: rgba(79, 195, 247, 0.1);
  border-left-color: var(--info);
  color: var(--info);
}

/* Loading Animation */
.loading {
  display: none;
  text-align: center;
  padding: 30px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid rgba(0, 255, 153, 0.1);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Progress Bar */
.progress-bar {
  width: 100%;
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
  margin: 15px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--primary-dark));
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* Tooltip */
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltip-text {
  visibility: hidden;
  width: 200px;
  background: var(--bg-1);
  color: var(--text-light);
  text-align: center;
  padding: 8px;
  border-radius: 6px;
  position: absolute;
  z-index: 1000;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.9rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 5px;
  margin-bottom: 20px;
  background: rgba(0, 0, 0, 0.2);
  padding: 5px;
  border-radius: 10px;
  overflow-x: auto;
}

.tab {
  flex: 1;
  min-width: 100px;
  padding: 10px;
  text-align: center;
  background: transparent;
  border: none;
  color: var(--text-muted);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  white-space: nowrap;
}

.tab.active {
  background: rgba(0, 255, 153, 0.2);
  color: var(--primary);
}

/* Chart Container */
.chart-container {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.chart-title {
  color: var(--primary);
  font-size: 1.1rem;
  margin-bottom: 15px;
  font-weight: 600;
}

.chart-grid {
  display: grid;
  grid-template-columns: repeat(13, 1fr);
  gap: 5px;
  margin-top: 15px;
}

.chart-cell {
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.chart-cell.high {
  background: linear-gradient(135deg, var(--danger), #cc0000);
}

.chell.medium {
  background: linear-gradient(135deg, var(--warning), #cc9900);
}

.chart-cell.low {
  background: linear-gradient(135deg, var(--info), #0288d1);
}

.chart-cell:hover {
  transform: scale(1.1);
  z-index: 1;
}

/* Number Distribution */
.distribution-grid {
  display: grid;
  grid-template-columns: repeat(13, 1fr);
  gap: 8px;
  margin: 20px 0;
}

.dist-cell {
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 8px;
  font-weight: bold;
  position: relative;
  border: 2px solid transparent;
  transition: all 0.3s ease;
}

.dist-cell.hot {
  background: linear-gradient(135deg, rgba(255, 102, 102, 0.3), rgba(204, 0, 0, 0.3));
  border-color: var(--danger);
}

.dist-cell.cold {
  background: linear-gradient(135deg, rgba(79, 195, 247, 0.3), rgba(2, 136, 209, 0.3));
  border-color: var(--info);
}

.dist-cell.normal {
  background: rgba(255, 255, 255, 0.1);
}

.dist-cell:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* Footer */
.footer {
  text-align: center;
  padding: 20px;
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-top: 40px;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.footer a {
  color: var(--primary);
  text-decoration: none;
  transition: color 0.3s ease;
}

.footer a:hover {
  color: var(--text-light);
  text-decoration: underline;
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  .header h1 {
    font-size: 2rem;
  }
  
  .panel {
    padding: 20px;
  }
  
  .numbers-grid {
    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    gap: 10px;
  }
  
  .number-ball {
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
  }
  
  .stats-row {
    grid-template-columns: 1fr 1fr;
  }
  
  .btn-group {
    grid-template-columns: 1fr;
  }
  
  .distribution-grid {
    grid-template-columns: repeat(10, 1fr);
  }
}

@media (max-width: 480px) {
  .stats-row {
    grid-template-columns: 1fr;
  }
  
  .header h1 {
    font-size: 1.8rem;
  }
  
  .distribution-grid {
    grid-template-columns: repeat(8, 1fr);
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ¯ ä¸‰æ˜Ÿ-é æ¸¬ç³»çµ± v3.0</h1>
    <div class="subtitle">æ™ºèƒ½é æ¸¬åˆ†æç³»çµ± | é€£è™Ÿåˆ†å¸ƒåˆ†æ | å¤šç¶­åº¦çµ±è¨ˆ</div>
  </div>

  <!-- Panel 1ï¼šæ•¸æ“šå°å…¥ -->
  <div class="panel panel-1">
    <h2>ğŸ“Š æ•¸æ“šå°å…¥å±¤</h2>
    <div class="file-input-wrapper">
      <input type="file" id="csvInput" class="file-input" accept=".csv">
    </div>
    <div class="status info">æ”¯æŒCSVæ ¼å¼ï¼Œæ ¼å¼ï¼šæ—¥æœŸ,è™Ÿç¢¼1,è™Ÿç¢¼2,è™Ÿç¢¼3,è™Ÿç¢¼4,è™Ÿç¢¼5</div>
    <div id="csvInfo"></div>
    <div id="basicStats" style="display: none;"></div>
  </div>

  <!-- Panel Aï¼šæ™ºèƒ½åˆ†æ -->
  <div class="panel panel-2">
    <h2>ğŸ” æ™ºèƒ½åˆ†æå±¤</h2>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runFullAnalysis()">
        <span class="icon">ğŸ“ˆ</span> å®Œæ•´åˆ†æ
      </button>
      <button class="btn" onclick="runQuickAnalysis()">
        <span class="icon">âš¡</span> å¿«é€Ÿåˆ†æ
      </button>
      <button class="btn" onclick="analyzePatterns()">
        <span class="icon">ğŸ”¬</span> æ¨¡å¼åˆ†æ
      </button>
    </div>
    
    <div class="loading" id="loadingA">
      <div class="spinner"></div>
      <div>æ­£åœ¨åˆ†ææ•¸æ“š...</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
    
    <div id="panelA" style="display: none;">
      <div class="tabs" id="analysisTabs">
        <button class="tab active" onclick="switchAnalysisTab('frequency')">é »ç‡åˆ†æ</button>
        <button class="tab" onclick="switchAnalysisTab('trend')">è¶¨å‹¢åˆ†æ</button>
        <button class="tab" onclick="switchAnalysisTab('patterns')">æ¨¡å¼åˆ†æ</button>
        <button class="tab" onclick="switchAnalysisTab('consecutive')">é€£è™Ÿåˆ†æ</button>
        <button class="tab" onclick="switchAnalysisTab('distribution')">è™Ÿç¢¼åˆ†å¸ƒ</button>
      </div>
      <div id="analysisContent"></div>
    </div>
  </div>

  <!-- Panel Bï¼šçµ„åˆé©—è­‰ -->
  <div class="panel panel-3">
    <h2>âœ… çµ„åˆé©—è­‰å±¤</h2>
    <div class="btn-group">
      <div>
        <input type="text" id="verifyInput" class="text-input" 
               placeholder="è¼¸å…¥5å€‹è™Ÿç¢¼ï¼Œå¦‚ï¼š1 2 16 33 35">
        <button class="btn btn-primary" onclick="runVerify()">åˆ†æçµ„åˆ</button>
      </div>
      <div>
        <button class="btn" onclick="generateRandomCombination()">éš¨æ©Ÿç”Ÿæˆ</button>
        <button class="btn" onclick="clearVerification()">æ¸…é™¤</button>
      </div>
    </div>
    
    <div id="panelB" style="display: none;"></div>
  </div>

  <!-- Panel Cï¼šé æ¸¬ç”Ÿæˆ -->
  <div class="panel panel-4">
    <h2>ğŸ¯ é æ¸¬ç”Ÿæˆå±¤</h2>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="generateSmartPrediction()">
        <span class="icon">ğŸ¤–</span> æ™ºèƒ½é æ¸¬
      </button>
      <button class="btn" onclick="generateTrendPrediction()">
        <span class="icon">ğŸ“Š</span> è¶¨å‹¢é æ¸¬
      </button>
      <button class="btn" onclick="generateBalancedPrediction()">
        <span class="icon">âš–ï¸</span> å¹³è¡¡é æ¸¬
      </button>
      <button class="btn" onclick="generateConsecutivePrediction()">
        <span class="icon">ğŸ”—</span> é€£è™Ÿé æ¸¬
      </button>
    </div>
    
    <div class="loading" id="loadingC">
      <div class="spinner"></div>
      <div>æ­£åœ¨ç”Ÿæˆé æ¸¬...</div>
    </div>
    
    <div id="panelC" style="display: none;">
      <div id="predictionResults"></div>
    </div>
  </div>

  <!-- Panel Dï¼šé æ¸¬é‚è¼¯èªªæ˜ -->
  <div class="panel panel-0">
    <h2 id="toggleLogic" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
      <span>ğŸ§  ç³»çµ±èªªæ˜èˆ‡çµ±è¨ˆ</span>
      <span style="font-size: 1rem;">â–¼</span>
    </h2>
    <div id="logicContent" style="display: none;">
      <div class="status info">
        <strong>ç‰ˆæœ¬ 3.0 æ›´æ–°ï¼š</strong> ä¿®å¾©æ‰€æœ‰åŠŸèƒ½ï¼Œæ–°å¢é€£è™Ÿåˆ†æã€è™Ÿç¢¼åˆ†å¸ƒåœ–ã€æ›´æº–ç¢ºçš„é æ¸¬ç®—æ³•
      </div>
      
      <div style="margin: 20px 0;">
        <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ“ˆ æ ¸å¿ƒç®—æ³•</h3>
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-label">é »ç‡æ¬Šé‡</div>
            <div class="stat-value">35%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">éºæ¼åˆ†æ</div>
            <div class="stat-value">25%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">è¶¨å‹¢é æ¸¬</div>
            <div class="stat-value">20%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">é€£è™Ÿåˆ†æ</div>
            <div class="stat-value">20%</div>
          </div>
        </div>
      </div>
      
      <div class="status warning">
        âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç³»çµ±åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œä¸å…·ä»»ä½•é æ¸¬ä¿è­‰åŠŸèƒ½ã€‚å½©ç¥¨é–‹çç‚ºéš¨æ©Ÿäº‹ä»¶ï¼Œè«‹ç†æ€§åƒèˆ‡ã€‚
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Â© 2023 ä¸‰æ˜Ÿé æ¸¬ç³»çµ± v3.0 | æ•¸æ“šåˆ†æå¼•æ“ | æœ€å¾Œæ›´æ–°: 2023-11</p>
    <p>âš ï¸ æœ¬ç³»çµ±åŸºæ–¼æ­·å²æ•¸æ“šåˆ†æï¼Œåƒ…ä¾›å¨›æ¨‚åƒè€ƒã€‚è«‹ç†æ€§åƒèˆ‡ï¼Œé‡åŠ›è€Œè¡Œã€‚</p>
  </div>
</div>

<script>
// å…¨å±€æ•¸æ“šå­˜å„²
let data = [];
let analysisCache = null;
let currentAnalysisTab = 'frequency';

// åˆå§‹åŒ–é é¢
document.addEventListener('DOMContentLoaded', function() {
  initializeFileDrop();
  loadSampleData();
  
  // é»æ“Šæ”¶åˆé‚è¼¯èªªæ˜
  document.getElementById('toggleLogic').addEventListener('click', function() {
    const content = document.getElementById('logicContent');
    const icon = this.querySelector('span:last-child');
    
    if (content.style.display === 'none') {
      content.style.display = 'block';
      icon.textContent = 'â–²';
    } else {
      content.style.display = 'none';
      icon.textContent = 'â–¼';
    }
  });
});

// åˆå§‹åŒ–æ–‡ä»¶æ‹–æ”¾
function initializeFileDrop() {
  const panel1 = document.querySelector('.panel-1');
  const fileInput = document.getElementById('csvInput');
  
  panel1.addEventListener('dragover', function(e) {
    e.preventDefault();
    panel1.style.borderColor = 'var(--primary)';
    panel1.style.transform = 'scale(1.02)';
  });
  
  panel1.addEventListener('dragleave', function() {
    panel1.style.borderColor = 'rgba(255, 255, 255, 0.05)';
    panel1.style.transform = 'scale(1)';
  });
  
  panel1.addEventListener('drop', function(e) {
    e.preventDefault();
    panel1.style.borderColor = 'rgba(255, 255, 255, 0.05)';
    panel1.style.transform = 'scale(1)';
    
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;
      handleFileUpload();
    }
  });
  
  fileInput.addEventListener('change', handleFileUpload);
}

// è™•ç†æ–‡ä»¶ä¸Šå‚³
function handleFileUpload() {
  const fileInput = document.getElementById('csvInput');
  const file = fileInput.files[0];
  
  if (!file) return;
  
  showStatus('csvInfo', 'æ­£åœ¨è®€å–æ–‡ä»¶...', 'info');
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const result = parseCSVData(event.target.result);
      if (result.success) {
        showStatus('csvInfo', `âœ… å·²è¼‰å…¥ ${data.length} æœŸæ•¸æ“š`, 'success');
        displayBasicStats();
      } else {
        showStatus('csvInfo', `âŒ ${result.message}`, 'error');
      }
    } catch (error) {
      showStatus('csvInfo', `âŒ è§£æéŒ¯èª¤: ${error.message}`, 'error');
    }
  };
  
  reader.onerror = function() {
    showStatus('csvInfo', 'âŒ æ–‡ä»¶è®€å–å¤±æ•—', 'error');
  };
  
  reader.readAsText(file, 'UTF-8');
}

// è§£æCSVæ•¸æ“š
function parseCSVData(content) {
  const lines = content.trim().split(/\r?\n/);
  data = [];
  
  if (lines.length < 2) {
    return { success: false, message: 'æ–‡ä»¶å…§å®¹å¤ªå°‘' };
  }
  
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line || line.startsWith('#')) continue;
    
    // æ”¯æŒå¤šç¨®åˆ†éš”ç¬¦ï¼šé€—è™Ÿã€ç©ºæ ¼ã€Tab
    const parts = line.split(/[,ï¼Œ\s\t]+/);
    
    if (parts.length >= 6) {
      const date = parts[0].trim();
      const numbers = [];
      
      for (let j = 1; j <= 5; j++) {
        const num = parseInt(parts[j].trim());
        if (isNaN(num) || num < 1 || num > 39) {
          return { success: false, message: `ç¬¬${i+1}è¡Œç¬¬${j}å€‹è™Ÿç¢¼ç„¡æ•ˆ` };
        }
        numbers.push(num);
      }
      
      // æª¢æŸ¥é‡è¤‡è™Ÿç¢¼
      if (new Set(numbers).size !== 5) {
        return { success: false, message: `ç¬¬${i+1}è¡Œæœ‰é‡è¤‡è™Ÿç¢¼` };
      }
      
      data.push({
        date: date,
        numbers: numbers.sort((a, b) => a - b),
        index: data.length
      });
    }
  }
  
  if (data.length === 0) {
    return { success: false, message: 'æœªæ‰¾åˆ°æœ‰æ•ˆæ•¸æ“šï¼Œè«‹æª¢æŸ¥æ ¼å¼' };
  }
  
  return { success: true, message: `æˆåŠŸè¼‰å…¥ ${data.length} æœŸæ•¸æ“š` };
}

// è¼‰å…¥ç¤ºä¾‹æ•¸æ“š
function loadSampleData() {
  try {
    // ç”Ÿæˆ100æœŸç¤ºä¾‹æ•¸æ“š
    const sampleData = [];
    const today = new Date();
    
    for (let i = 0; i < 100; i++) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      
      // ç”Ÿæˆç¬¦åˆçœŸå¯¦çµ±è¨ˆè¦å¾‹çš„è™Ÿç¢¼
      const numbers = generateSampleNumbers();
      
      sampleData.push({
        date: date.toISOString().split('T')[0],
        numbers: numbers.sort((a, b) => a - b),
        index: i
      });
    }
    
    data = sampleData;
    showStatus('csvInfo', 'ğŸ“‹ ç¤ºä¾‹æ•¸æ“šå·²è¼‰å…¥ (100æœŸ)', 'info');
    displayBasicStats();
  } catch (error) {
    console.error('è¼‰å…¥ç¤ºä¾‹æ•¸æ“šå¤±æ•—:', error);
    showStatus('csvInfo', 'è¼‰å…¥ç¤ºä¾‹æ•¸æ“šå¤±æ•—', 'error');
  }
}

// ç”Ÿæˆç¤ºä¾‹è™Ÿç¢¼
function generateSampleNumbers() {
  const numbers = new Set();
  
  // ç¢ºä¿ä¸€å®šçš„å¤šæ¨£æ€§
  while (numbers.size < 5) {
    // å¢åŠ æŸäº›è™Ÿç¢¼çš„å‡ºç¾æ¦‚ç‡ï¼ˆæ¨¡æ“¬çœŸå¯¦æƒ…æ³ï¼‰
    let num;
    if (Math.random() < 0.3) {
      // 30% æ¦‚ç‡å‡ºç¾ç†±é–€è™Ÿç¢¼ï¼ˆ1-15ï¼‰
      num = Math.floor(Math.random() * 15) + 1;
    } else if (Math.random() < 0.5) {
      // 50% æ¦‚ç‡å‡ºç¾ä¸­ç­‰è™Ÿç¢¼ï¼ˆ16-30ï¼‰
      num = Math.floor(Math.random() * 15) + 16;
    } else {
      // 20% æ¦‚ç‡å‡ºç¾å†·é–€è™Ÿç¢¼ï¼ˆ31-39ï¼‰
      num = Math.floor(Math.random() * 9) + 31;
    }
    
    if (!numbers.has(num)) {
      numbers.add(num);
    }
  }
  
  return Array.from(numbers);
}

// é¡¯ç¤ºåŸºæœ¬çµ±è¨ˆ
function displayBasicStats() {
  if (data.length === 0) return;
  
  const stats = calculateBasicStats();
  const container = document.getElementById('basicStats');
  
  container.style.display = 'grid';
  container.innerHTML = `
    <div class="stat-item">
      <div class="stat-label">ç¸½æœŸæ•¸</div>
      <div class="stat-value">${stats.totalDraws}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">æ•¸æ“šç¯„åœ</div>
      <div class="stat-value" style="font-size: 0.9rem">${stats.dateRange}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">ç†±é–€è™Ÿç¢¼</div>
      <div class="stat-value" style="color:var(--danger); font-size: 1.2rem">${stats.hotNumbers.slice(0, 3).join(' ')}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">å†·é–€è™Ÿç¢¼</div>
      <div class="stat-value" style="color:var(--info); font-size: 1.2rem">${stats.coldNumbers.slice(0, 3).join(' ')}</div>
    </div>
  `;
}

// è¨ˆç®—åŸºæœ¬çµ±è¨ˆ
function calculateBasicStats() {
  const frequency = {};
  const dates = [];
  
  data.forEach(draw => {
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
    });
    dates.push(draw.date);
  });
  
  const allNumbers = Array.from({length: 39}, (_, i) => i + 1);
  const sortedNumbers = allNumbers.sort((a, b) => (frequency[b] || 0) - (frequency[a] || 0));
  
  return {
    totalDraws: data.length,
    dateRange: `${dates[dates.length-1]} è‡³ ${dates[0]}`,
    hotNumbers: sortedNumbers.slice(0, 10),
    coldNumbers: sortedNumbers.slice(-10).reverse(),
    frequency
  };
}

// åŸ·è¡Œå®Œæ•´åˆ†æ
function runFullAnalysis() {
  if (!validateData()) return;
  
  showLoading('loadingA', true);
  animateProgress('progressFill', 1000);
  
  setTimeout(() => {
    try {
      analysisCache = calculateAdvancedStats();
      displayAnalysisResults();
      showLoading('loadingA', false);
    } catch (error) {
      console.error('åˆ†æå¤±æ•—:', error);
      showLoading('loadingA', false);
      alert('åˆ†æå¤±æ•—ï¼Œè«‹æª¢æŸ¥æ•¸æ“šæ ¼å¼');
    }
  }, 1000);
}

// åŸ·è¡Œå¿«é€Ÿåˆ†æ
function runQuickAnalysis() {
  if (!validateData()) return;
  
  showLoading('loadingA', true);
  animateProgress('progressFill', 500);
  
  setTimeout(() => {
    try {
      analysisCache = calculateQuickStats();
      displayAnalysisResults();
      showLoading('loadingA', false);
    } catch (error) {
      console.error('å¿«é€Ÿåˆ†æå¤±æ•—:', error);
      showLoading('loadingA', false);
    }
  }, 500);
}

// åˆ†ææ¨¡å¼
function analyzePatterns() {
  if (!validateData()) return;
  
  showLoading('loadingA', true);
  
  setTimeout(() => {
    try {
      analysisCache = calculateAdvancedStats();
      switchAnalysisTab('patterns');
      showLoading('loadingA', false);
    } catch (error) {
      console.error('æ¨¡å¼åˆ†æå¤±æ•—:', error);
      showLoading('loadingA', false);
    }
  }, 800);
}

// åˆ‡æ›åˆ†ææ¨™ç±¤é 
function switchAnalysisTab(tab) {
  currentAnalysisTab = tab;
  
  // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
  document.querySelectorAll('#analysisTabs .tab').forEach(t => {
    t.classList.remove('active');
  });
  
  const activeTab = document.querySelector(`#analysisTabs .tab:nth-child(${getTabIndex(tab)})`);
  if (activeTab) activeTab.classList.add('active');
  
  // é¡¯ç¤ºå°æ‡‰å…§å®¹
  displayAnalysisTab(tab);
}

// ç²å–æ¨™ç±¤ç´¢å¼•
function getTabIndex(tab) {
  const tabs = ['frequency', 'trend', 'patterns', 'consecutive', 'distribution'];
  return tabs.indexOf(tab) + 1;
}

// é¡¯ç¤ºåˆ†ææ¨™ç±¤é å…§å®¹
function displayAnalysisTab(tab) {
  if (!analysisCache) {
    analysisCache = calculateAdvancedStats();
  }
  
  const container = document.getElementById('analysisContent');
  let content = '';
  
  switch(tab) {
    case 'frequency':
      content = generateFrequencyTab();
      break;
    case 'trend':
      content = generateTrendTab();
      break;
    case 'patterns':
      content = generatePatternsTab();
      break;
    case 'consecutive':
      content = generateConsecutiveTab();
      break;
    case 'distribution':
      content = generateDistributionTab();
      break;
  }
  
  container.innerHTML = content;
  attachNumberClickEvents();
}

// ç”Ÿæˆé »ç‡åˆ†æå…§å®¹
function generateFrequencyTab() {
  const { frequency, hotNumbers, coldNumbers } = analysisCache;
  
  // è¨ˆç®—å¹³å‡é »ç‡
  const avgFrequency = (data.length * 5 / 39).toFixed(1);
  
  return `
    <div class="box">
      <div class="box-title">ğŸ”¥ ç†±é–€è™Ÿç¢¼ TOP 10</div>
      <div class="numbers-grid">
        ${hotNumbers.map(num => `
          <div class="number-ball hot tooltip" 
               onclick="selectNumber(${num})"
               data-number="${num}">
            ${num}
            <span class="tooltip-text">
              å‡ºç¾ ${frequency[num]} æ¬¡<br>
              é »ç‡: ${((frequency[num]/data.length)*100).toFixed(1)}%<br>
              å¹³å‡æ‡‰å‡ºç¾: ${avgFrequency}æ¬¡
            </span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â„ï¸ å†·é–€è™Ÿç¢¼ TOP 10</div>
      <div class="numbers-grid">
        ${coldNumbers.map(num => `
          <div class="number-ball cold tooltip"
               onclick="selectNumber(${num})"
               data-number="${num}">
            ${num}
            <span class="tooltip-text">
              å‡ºç¾ ${frequency[num] || 0} æ¬¡<br>
              é »ç‡: ${(((frequency[num] || 0)/data.length)*100).toFixed(1)}%
            </span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“Š é »ç‡çµ±è¨ˆ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">æœ€é«˜é »ç‡</div>
          <div class="stat-value" style="color:var(--danger)">${hotNumbers[0]} (${frequency[hotNumbers[0]]}æ¬¡)</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€ä½é »ç‡</div>
          <div class="stat-value" style="color:var(--info)">${coldNumbers[0]} (${frequency[coldNumbers[0]] || 0}æ¬¡)</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å‡ºç¾</div>
          <div class="stat-value">${avgFrequency}æ¬¡</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœªå‡ºç¾æ•¸</div>
          <div class="stat-value">${Object.values(frequency).filter(f => f === 0).length}</div>
        </div>
      </div>
    </div>
  `;
}

// ç”Ÿæˆè¶¨å‹¢åˆ†æå…§å®¹
function generateTrendTab() {
  const { trendNumbers, lastSeen } = analysisCache;
  
  return `
    <div class="box">
      <div class="box-title">ğŸ“ˆ è¿‘æœŸç†±é–€è™Ÿç¢¼</div>
      <div class="numbers-grid">
        ${trendNumbers.slice(0, 15).map(item => `
          <div class="number-ball ${item.score > 70 ? 'hot' : item.score > 50 ? 'warm' : 'cold'} tooltip"
               onclick="selectNumber(${item.num})"
               data-number="${item.num}">
            ${item.num}
            <span class="tooltip-text">
              è¶¨å‹¢åˆ†æ•¸: ${item.score}<br>
              æœ€è¿‘5æœŸå‡ºç¾: ${item.recent5}æ¬¡<br>
              éºæ¼æœŸæ•¸: ${item.missed}<br>
              ç¸½å‡ºç¾: ${item.total}æ¬¡
            </span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â° é•·æœŸéºæ¼è™Ÿç¢¼</div>
      <div class="numbers-grid">
        ${Object.entries(lastSeen)
          .sort(([,a], [,b]) => b - a)
          .slice(0, 15)
          .map(([num, seen]) => {
            const missed = data.length - seen;
            return `
              <div class="number-ball missed tooltip"
                   onclick="selectNumber(${num})"
                   data-number="${num}">
                ${num}
                <span class="tooltip-text">
                  å·²éºæ¼ ${missed} æœŸ<br>
                  æœ€å¾Œå‡ºç¾: ç¬¬${seen + 1}æœŸ
                </span>
              </div>
            `;
          }).join('')}
      </div>
    </div>
  `;
}

// ç”Ÿæˆæ¨¡å¼åˆ†æå…§å®¹
function generatePatternsTab() {
  const { sumStats, oddEvenStats, sizeStats, consecutiveStats } = analysisCache;
  
  return `
    <div class="box">
      <div class="box-title">ğŸ§® å’Œå€¼åˆ†æ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å’Œå€¼</div>
          <div class="stat-value">${sumStats.avg}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å°å’Œå€¼</div>
          <div class="stat-value">${sumStats.min}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å¤§å’Œå€¼</div>
          <div class="stat-value">${sumStats.max}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å»ºè­°ç¯„åœ</div>
          <div class="stat-value" style="font-size: 0.9rem">${sumStats.suggested}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">âš–ï¸ å¥‡å¶åˆ†æ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¸¸è¦‹æ¯”ä¾‹</div>
          <div class="stat-value">${oddEvenStats.common}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å¥‡æ•¸</div>
          <div class="stat-value">${oddEvenStats.avgOdd}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å…¨å¥‡/å…¨å¶</div>
          <div class="stat-value">${oddEvenStats.extreme}æ¬¡</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“ å¤§å°åˆ†æ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¸¸è¦‹åˆ†ä½ˆ</div>
          <div class="stat-value">${sizeStats.common}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å¤§æ•¸</div>
          <div class="stat-value">${sizeStats.avgLarge}</div>
        </div>
      </div>
    </div>
  `;
}

// ç”Ÿæˆé€£è™Ÿåˆ†æå…§å®¹
function generateConsecutiveTab() {
  const { consecutiveStats } = analysisCache;
  
  return `
    <div class="box">
      <div class="box-title">ğŸ”— é€£è™Ÿå‡ºç¾çµ±è¨ˆ</div>
      <div class="chart-container">
        <div class="chart-title">é€£è™Ÿå°å‡ºç¾ç†±åº¦åœ–</div>
        <div class="chart-grid">
          ${Array.from({length: 39}, (_, i) => {
            const num = i + 1;
            const nextNum = num + 1;
            const count = consecutiveStats.pairs[`${num}-${nextNum}`] || 0;
            const maxCount = Math.max(...Object.values(consecutiveStats.pairs));
            const intensity = count / maxCount;
            
            let colorClass = '';
            if (intensity > 0.7) colorClass = 'high';
            else if (intensity > 0.3) colorClass = 'medium';
            else if (count > 0) colorClass = 'low';
            
            return `
              <div class="chart-cell ${colorClass} tooltip">
                ${num}
                <span class="tooltip-text">
                  é€£è™Ÿ ${num}-${nextNum}<br>
                  å‡ºç¾ ${count} æ¬¡<br>
                  æ¦‚ç‡: ${((count / data.length) * 100).toFixed(1)}%
                </span>
              </div>
            `;
          }).join('')}
        </div>
      </div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¹³å‡é€£è™Ÿæ•¸</div>
          <div class="stat-value">${consecutiveStats.avgConsecutive.toFixed(2)}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ‰é€£è™ŸæœŸæ•¸</div>
          <div class="stat-value">${consecutiveStats.hasConsecutive}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å¤šé€£è™Ÿ</div>
          <div class="stat-value">${consecutiveStats.maxConsecutive}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ç†±é–€é€£è™Ÿ</div>
          <div class="stat-value" style="font-size: 0.9rem">${consecutiveStats.topPairs[0] || 'ç„¡'}</div>
        </div>
      </div>
    </div>
  `;
}

// ç”Ÿæˆè™Ÿç¢¼åˆ†å¸ƒå…§å®¹
function generateDistributionTab() {
  const { frequency } = analysisCache;
  const maxFreq = Math.max(...Object.values(frequency));
  
  return `
    <div class="box">
      <div class="box-title">ğŸ¯ è™Ÿç¢¼åˆ†å¸ƒç†±åœ–</div>
      <div class="distribution-grid">
        ${Array.from({length: 39}, (_, i) => {
          const num = i + 1;
          const freq = frequency[num] || 0;
          const intensity = freq / maxFreq;
          
          let colorClass = 'normal';
          if (intensity > 0.7) colorClass = 'hot';
          else if (intensity > 0.3) colorClass = 'normal';
          else colorClass = 'cold';
          
          return `
            <div class="dist-cell ${colorClass} tooltip"
                 onclick="selectNumber(${num})"
                 data-number="${num}">
              ${num}
              <span class="tooltip-text">
                è™Ÿç¢¼ ${num}<br>
                å‡ºç¾ ${freq} æ¬¡<br>
                æ¦‚ç‡: ${((freq / data.length) * 100).toFixed(1)}%
              </span>
            </div>
          `;
        }).join('')}
      </div>
    </div>
  `;
}

// è¨ˆç®—é€²éšçµ±è¨ˆ
function calculateAdvancedStats() {
  const frequency = {};
  const lastSeen = {};
  const recentFrequency = {};
  const sums = [];
  const oddCounts = [];
  const largeCounts = [];
  const consecutivePairs = {};
  let totalConsecutive = 0;
  let hasConsecutiveCount = 0;
  let maxConsecutive = 0;
  
  // åˆ†ææœ€è¿‘20æœŸ
  const recentData = data.slice(-20);
  
  // æ”¶é›†æ•¸æ“š
  data.forEach((draw, index) => {
    const numbers = draw.numbers;
    
    // é »ç‡å’Œæœ€å¾Œå‡ºç¾ä½ç½®
    numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
      lastSeen[num] = index;
      
      // æœ€è¿‘20æœŸé »ç‡
      if (index >= data.length - 20) {
        recentFrequency[num] = (recentFrequency[num] || 0) + 1;
      }
    });
    
    // å’Œå€¼
    const sum = numbers.reduce((a, b) => a + b, 0);
    sums.push(sum);
    
    // å¥‡å¶æ¯”
    const oddCount = numbers.filter(n => n % 2 === 1).length;
    oddCounts.push(oddCount);
    
    // å¤§å°æ¯” (å¤§æ•¸: 20-39)
    const largeCount = numbers.filter(n => n >= 20).length;
    largeCounts.push(largeCount);
    
    // é€£è™Ÿåˆ†æ
    let consecutiveCount = 0;
    let currentMax = 0;
    for (let i = 0; i < numbers.length - 1; i++) {
      if (numbers[i + 1] - numbers[i] === 1) {
        const pair = `${numbers[i]}-${numbers[i + 1]}`;
        consecutivePairs[pair] = (consecutivePairs[pair] || 0) + 1;
        consecutiveCount++;
        currentMax++;
        maxConsecutive = Math.max(maxConsecutive, currentMax);
      } else {
        currentMax = 0;
      }
    }
    
    totalConsecutive += consecutiveCount;
    if (consecutiveCount > 0) hasConsecutiveCount++;
  });
  
  // ç†±é–€è™Ÿç¢¼
  const allNumbers = Array.from({length: 39}, (_, i) => i + 1);
  const hotNumbers = allNumbers
    .sort((a, b) => (frequency[b] || 0) - (frequency[a] || 0))
    .slice(0, 10);
  
  // å†·é–€è™Ÿç¢¼
  const coldNumbers = allNumbers
    .sort((a, b) => (frequency[a] || 0) - (frequency[b] || 0))
    .slice(0, 10);
  
  // è¶¨å‹¢è™Ÿç¢¼
  const trendNumbers = allNumbers
    .map(num => {
      const total = frequency[num] || 0;
      const recent = recentFrequency[num] || 0;
      const last5Index = Math.max(0, data.length - 5);
      const recent5 = data.slice(last5Index).filter(d => d.numbers.includes(num)).length;
      const missed = data.length - (lastSeen[num] || 0);
      
      // è¶¨å‹¢è©•åˆ†
      let score = 0;
      if (recent5 > 0) score += 30;
      if (recent > 0) score += 20;
      score += Math.max(0, 30 - missed);
      score += Math.min(30, total);
      
      return {
        num,
        total,
        recent,
        recent5,
        missed,
        score: Math.min(100, score)
      };
    })
    .sort((a, b) => b.score - a.score)
    .slice(0, 15);
  
  // å’Œå€¼çµ±è¨ˆ
  const sumAvg = Math.round(sums.reduce((a, b) => a + b, 0) / sums.length);
  const sumMin = Math.min(...sums);
  const sumMax = Math.max(...sums);
  
  // å¥‡å¶çµ±è¨ˆ
  const oddAvg = (oddCounts.reduce((a, b) => a + b, 0) / oddCounts.length).toFixed(1);
  const oddCountMap = {};
  oddCounts.forEach(count => {
    oddCountMap[count] = (oddCountMap[count] || 0) + 1;
  });
  const commonOdd = Object.entries(oddCountMap).sort((a, b) => b[1] - a[1])[0];
  const extremeOdd = (oddCountMap[0] || 0) + (oddCountMap[5] || 0);
  
  // å¤§å°çµ±è¨ˆ
  const largeAvg = (largeCounts.reduce((a, b) => a + b, 0) / largeCounts.length).toFixed(1);
  const largeCountMap = {};
  largeCounts.forEach(count => {
    largeCountMap[count] = (largeCountMap[count] || 0) + 1;
  });
  const commonLarge = Object.entries(largeCountMap).sort((a, b) => b[1] - a[1])[0];
  
  // é€£è™Ÿçµ±è¨ˆ
  const topPairs = Object.entries(consecutivePairs)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5)
    .map(([pair]) => pair);
  
  return {
    frequency,
    lastSeen,
    hotNumbers,
    coldNumbers,
    trendNumbers,
    sumStats: {
      avg: sumAvg,
      min: sumMin,
      max: sumMax,
      suggested: `${Math.round(sumAvg * 0.9)}-${Math.round(sumAvg * 1.1)}`
    },
    oddEvenStats: {
      avgOdd: oddAvg,
      common: `${commonOdd[0]}å¥‡${5 - commonOdd[0]}å¶`,
      extreme: extremeOdd
    },
    sizeStats: {
      avgLarge: largeAvg,
      common: `${commonLarge[0]}å¤§${5 - commonLarge[0]}å°`
    },
    consecutiveStats: {
      pairs: consecutivePairs,
      avgConsecutive: totalConsecutive / data.length,
      hasConsecutive: hasConsecutiveCount,
      maxConsecutive,
      topPairs
    }
  };
}

// è¨ˆç®—å¿«é€Ÿçµ±è¨ˆ
function calculateQuickStats() {
  const frequency = {};
  
  data.forEach(draw => {
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
    });
  });
  
  return { frequency };
}

// é¡¯ç¤ºåˆ†æçµæœ
function displayAnalysisResults() {
  const container = document.getElementById('panelA');
  container.style.display = 'block';
  displayAnalysisTab(currentAnalysisTab);
}

// é©—è­‰çµ„åˆ
function runVerify() {
  const input = document.getElementById('verifyInput').value.trim();
  if (!input) {
    alert('è«‹è¼¸å…¥è¦é©—è­‰çš„è™Ÿç¢¼çµ„åˆ');
    return;
  }
  
  // è§£æè¼¸å…¥
  const numbers = input.split(/\s+/)
    .map(num => parseInt(num.trim()))
    .filter(n => !isNaN(n));
  
  if (!validateCombination(numbers)) return;
  
  const container = document.getElementById('panelB');
  container.style.display = 'block';
  container.innerHTML = generateVerificationResults(numbers);
}

// ç”Ÿæˆé©—è­‰çµæœ
function generateVerificationResults(numbers) {
  if (!analysisCache) {
    analysisCache = calculateAdvancedStats();
  }
  
  const sortedNumbers = [...numbers].sort((a, b) => a - b);
  const stats = analysisCache;
  
  // è¨ˆç®—çµ„åˆç‰¹æ€§
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const largeCount = numbers.filter(n => n >= 20).length;
  const sum = numbers.reduce((a, b) => a + b, 0);
  const avg = sum / 5;
  const span = sortedNumbers[4] - sortedNumbers[0];
  
  // æª¢æŸ¥é€£è™Ÿ
  let consecutiveCount = 0;
  let hasConsecutive = false;
  for (let i = 0; i < sortedNumbers.length - 1; i++) {
    if (sortedNumbers[i + 1] - sortedNumbers[i] === 1) {
      consecutiveCount++;
      hasConsecutive = true;
    }
  }
  
  // è©•ä¼°çµ„åˆ
  const score = evaluateCombination(numbers, stats);
  const rating = getRating(score);
  
  // è™Ÿç¢¼è©³ç´°åˆ†æ
  const numberAnalysis = numbers.map(num => {
    const freq = stats.frequency[num] || 0;
    const missed = data.length - (stats.lastSeen[num] || 0);
    const freqRatio = ((freq / data.length) * 100).toFixed(1);
    const avgFreq = (data.length * 5 / 39).toFixed(1);
    
    let status = 'æ­£å¸¸';
    let statusColor = 'var(--text-muted)';
    let score = 0;
    
    if (freq > avgFreq * 1.5) {
      status = 'ç†±é–€';
      statusColor = 'var(--danger)';
      score = 6;
    } else if (freq < avgFreq * 0.5) {
      status = 'å†·é–€';
      statusColor = 'var(--info)';
      score = 4;
    } else {
      status = 'æº«è™Ÿ';
      statusColor = 'var(--warning)';
      score = 8;
    }
    
    if (missed > 20) {
      status = 'é•·æœŸéºæ¼';
      statusColor = 'var(--warning)';
      score += 5;
    } else if (missed < 5) {
      status = 'è¿‘æœŸå‡ºç¾';
      score += 2;
    } else {
      score += 4;
    }
    
    return { num, freq, missed, freqRatio, status, statusColor, score };
  });
  
  return `
    <div class="box">
      <div class="box-title">ğŸ“‹ çµ„åˆé©—è­‰çµæœ</div>
      
      <div class="numbers-grid">
        ${sortedNumbers.map(num => `
          <div class="number-ball ${numberAnalysis.find(n => n.num === num)?.status.includes('ç†±é–€') ? 'hot' : 
                                  numberAnalysis.find(n => n.num === num)?.status.includes('å†·é–€') ? 'cold' : ''}">
            ${num}
          </div>
        `).join('')}
      </div>
      
      <div class="status ${rating.status}">
        <strong>${rating.title} (${score}/100)</strong><br>
        ${rating.description}
      </div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶æ¯”ä¾‹</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¤§å°æ¯”ä¾‹</div>
          <div class="stat-value">${largeCount}å¤§${5-largeCount}å°</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">é€£è™Ÿæ•¸é‡</div>
          <div class="stat-value">${consecutiveCount}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ” è©³ç´°åˆ†æ</div>
      ${numberAnalysis.map(item => `
        <div style="padding: 10px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong style="color: var(--primary);">è™Ÿç¢¼ ${item.num}</strong>
              <span style="color: ${item.statusColor}; margin-left: 10px; font-size: 0.9rem;">
                ${item.status}
              </span>
            </div>
            <div style="font-size: 0.9rem; color: var(--text-muted);">
              å‡ºç¾ ${item.freq} æ¬¡ | éºæ¼ ${item.missed} æœŸ
            </div>
          </div>
          <div style="font-size: 0.9rem; color: var(--text-muted); margin-top: 5px;">
            å‡ºç¾æ¦‚ç‡: ${item.freqRatio}% | è©•åˆ†: ${item.score}/20
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

// è©•ä¼°çµ„åˆ
function evaluateCombination(numbers, stats) {
  let score = 0;
  
  // 1. è™Ÿç¢¼ç†±åº¦ (0-30åˆ†)
  numbers.forEach(num => {
    const freq = stats.frequency[num] || 0;
    const avgFreq = data.length * 5 / 39;
    
    if (Math.abs(freq - avgFreq) <= 2) score += 6;
    else if (freq > avgFreq) score += 5;
    else score += 4;
  });
  
  // 2. éºæ¼åˆ†æ (0-20åˆ†)
  numbers.forEach(num => {
    const missed = data.length - (stats.lastSeen[num] || 0);
    if (missed >= 8 && missed <= 20) score += 4;
    else if (missed > 20) score += 3;
    else if (missed < 5) score += 2;
    else score += 3;
  });
  
  // 3. å¥‡å¶å¹³è¡¡ (0-15åˆ†)
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const oddDiff = Math.abs(oddCount - 2.5);
  score += Math.max(0, 15 - oddDiff * 4);
  
  // 4. å’Œå€¼åˆç†æ€§ (0-15åˆ†)
  const sum = numbers.reduce((a, b) => a + b, 0);
  const sumDiff = Math.abs(sum - stats.sumStats.avg);
  score += Math.max(0, 15 - sumDiff / 10);
  
  // 5. åˆ†å¸ƒåˆç†æ€§ (0-10åˆ†)
  const sorted = [...numbers].sort((a, b) => a - b);
  const span = sorted[4] - sorted[0];
  if (span >= 20 && span <= 30) score += 10;
  else if (span >= 15 && span <= 35) score += 8;
  else score += 5;
  
  // 6. é€£è™Ÿåˆç†æ€§ (0-10åˆ†)
  let consecutiveCount = 0;
  for (let i = 0; i < sorted.length - 1; i++) {
    if (sorted[i + 1] - sorted[i] === 1) consecutiveCount++;
  }
  if (consecutiveCount === 1) score += 10;
  else if (consecutiveCount === 0) score += 8;
  else score += 5;
  
  return Math.min(100, Math.round(score));
}

// ç²å–è©•ç´š
function getRating(score) {
  if (score >= 80) return {
    title: 'å„ªç§€çµ„åˆ',
    description: 'é€™å€‹çµ„åˆåœ¨å¤šå€‹ç¶­åº¦éƒ½è¡¨ç¾å„ªç§€',
    status: 'success'
  };
  if (score >= 70) return {
    title: 'è‰¯å¥½çµ„åˆ',
    description: 'çµ„åˆçµæ§‹åˆç†ï¼Œæœ‰è¼ƒé«˜çš„åƒè€ƒåƒ¹å€¼',
    status: 'success'
  };
  if (score >= 60) return {
    title: 'ä¸€èˆ¬çµ„åˆ',
    description: 'åŸºæœ¬åˆç†ï¼Œä½†éƒ¨åˆ†ç‰¹å¾µéœ€è¦èª¿æ•´',
    status: 'warning'
  };
  return {
    title: 'éœ€è¦æ”¹é€²',
    description: 'å»ºè­°é‡æ–°è€ƒæ…®çµ„åˆé¸æ“‡',
    status: 'error'
  };
}

// ç”Ÿæˆæ™ºèƒ½é æ¸¬
function generateSmartPrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    try {
      if (!analysisCache) {
        analysisCache = calculateAdvancedStats();
      }
      
      const prediction = generatePredictionNumbers('smart');
      displayPrediction(prediction, 'æ™ºèƒ½é æ¸¬');
      showLoading('loadingC', false);
    } catch (error) {
      console.error('ç”Ÿæˆé æ¸¬å¤±æ•—:', error);
      showLoading('loadingC', false);
      alert('ç”Ÿæˆé æ¸¬å¤±æ•—ï¼Œè«‹é‡è©¦');
    }
  }, 800);
}

// ç”Ÿæˆè¶¨å‹¢é æ¸¬
function generateTrendPrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    try {
      if (!analysisCache) {
        analysisCache = calculateAdvancedStats();
      }
      
      const prediction = generatePredictionNumbers('trend');
      displayPrediction(prediction, 'è¶¨å‹¢é æ¸¬');
      showLoading('loadingC', false);
    } catch (error) {
      console.error('ç”Ÿæˆé æ¸¬å¤±æ•—:', error);
      showLoading('loadingC', false);
    }
  }, 800);
}

// ç”Ÿæˆå¹³è¡¡é æ¸¬
function generateBalancedPrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    try {
      if (!analysisCache) {
        analysisCache = calculateAdvancedStats();
      }
      
      const prediction = generatePredictionNumbers('balanced');
      displayPrediction(prediction, 'å¹³è¡¡é æ¸¬');
      showLoading('loadingC', false);
    } catch (error) {
      console.error('ç”Ÿæˆé æ¸¬å¤±æ•—:', error);
      showLoading('loadingC', false);
    }
  }, 800);
}

// ç”Ÿæˆé€£è™Ÿé æ¸¬
function generateConsecutivePrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    try {
      if (!analysisCache) {
        analysisCache = calculateAdvancedStats();
      }
      
      const prediction = generatePredictionNumbers('consecutive');
      displayPrediction(prediction, 'é€£è™Ÿé æ¸¬');
      showLoading('loadingC', false);
    } catch (error) {
      console.error('ç”Ÿæˆé æ¸¬å¤±æ•—:', error);
      showLoading('loadingC', false);
    }
  }, 800);
}

// ç”Ÿæˆé æ¸¬è™Ÿç¢¼
function generatePredictionNumbers(strategy) {
  const stats = analysisCache;
  let candidates = [];
  
  switch(strategy) {
    case 'smart':
      candidates = generateSmartCandidates(stats);
      break;
    case 'trend':
      candidates = generateTrendCandidates(stats);
      break;
    case 'balanced':
      candidates = generateBalancedCandidates(stats);
      break;
    case 'consecutive':
      candidates = generateConsecutiveCandidates(stats);
      break;
  }
  
  // é¸æ“‡æœ€çµ‚è™Ÿç¢¼
  const selected = selectFinalNumbers(candidates, stats, strategy);
  
  return Array.from(new Set(selected)).sort((a, b) => a - b);
}

// ç”Ÿæˆæ™ºèƒ½å€™é¸
function generateSmartCandidates(stats) {
  const candidates = [];
  
  for (let num = 1; num <= 39; num++) {
    const freq = stats.frequency[num] || 0;
    const missed = data.length - (stats.lastSeen[num] || 0);
    const isHot = stats.hotNumbers.includes(num);
    const isTrend = stats.trendNumbers.some(t => t.num === num);
    
    let score = 50;
    
    // é »ç‡å› ç´ 
    const avgFreq = data.length * 5 / 39;
    if (Math.abs(freq - avgFreq) <= 2) score += 20;
    else if (freq > avgFreq) score += 15;
    
    // éºæ¼å› ç´ 
    if (missed >= 5 && missed <= 15) score += 25;
    else if (missed > 15) score += 20;
    
    // è¶¨å‹¢å› ç´ 
    if (isTrend) score += 15;
    if (isHot) score += 10;
    
    candidates.push({ num, score });
  }
  
  return candidates.sort((a, b) => b.score - a.score);
}

// ç”Ÿæˆè¶¨å‹¢å€™é¸
function generateTrendCandidates(stats) {
  return stats.trendNumbers.map(item => ({
    num: item.num,
    score: item.score
  })).sort((a, b) => b.score - a.score);
}

// ç”Ÿæˆå¹³è¡¡å€™é¸
function generateBalancedCandidates(stats) {
  const candidates = [];
  
  for (let num = 1; num <= 39; num++) {
    let score = 60;
    
    // ç¢ºä¿åˆ†å¸ƒå¹³è¡¡
    if (num <= 13) score += 10; // å°è™Ÿ
    else if (num >= 27) score += 10; // å¤§è™Ÿ
    
    if (num % 2 === 1) score += 10; // å¥‡æ•¸
    
    // é¿å…æ¥µç«¯
    const freq = stats.frequency[num] || 0;
    if (freq === 0) score -= 15;
    if (stats.hotNumbers.includes(num)) score += 5;
    if (stats.coldNumbers.includes(num)) score -= 5;
    
    candidates.push({ num, score });
  }
  
  return candidates.sort((a, b) => b.score - a.score);
}

// ç”Ÿæˆé€£è™Ÿå€™é¸
function generateConsecutiveCandidates(stats) {
  const candidates = [];
  const { pairs } = stats.consecutiveStats;
  
  for (let num = 1; num <= 39; num++) {
    let score = 40;
    
    // é€£è™Ÿå› ç´ 
    const pair1 = pairs[`${num-1}-${num}`] || 0;
    const pair2 = pairs[`${num}-${num+1}`] || 0;
    score += (pair1 + pair2) * 5;
    
    // é¿å…å­¤ç«‹
    if (pair1 === 0 && pair2 === 0) score -= 10;
    
    // åŸºæœ¬ç‰¹æ€§
    const freq = stats.frequency[num] || 0;
    if (freq > 0) score += Math.min(20, freq * 2);
    
    candidates.push({ num, score });
  }
  
  return candidates.sort((a, b) => b.score - a.score);
}

// é¸æ“‡æœ€çµ‚è™Ÿç¢¼
function selectFinalNumbers(candidates, stats, strategy) {
  const selected = [];
  const used = new Set();
  
  // é¸æ“‡å‰12å€‹å€™é¸
  const topCandidates = candidates.slice(0, 12);
  
  // æ ¹æ“šç­–ç•¥é¸æ“‡
  for (let i = 0; i < 5; i++) {
    // æ ¹æ“šç­–ç•¥èª¿æ•´é¸æ“‡é‚è¼¯
    let candidate;
    
    switch(strategy) {
      case 'balanced':
        // ç¢ºä¿å¥‡å¶å’Œå¤§å°çš„å¹³è¡¡
        const currentOdd = selected.filter(n => n % 2 === 1).length;
        const currentLarge = selected.filter(n => n >= 20).length;
        
        candidate = topCandidates.find(c => 
          !used.has(c.num) && 
          (i < 4 || (currentOdd >= 2 && currentOdd <= 3)) &&
          (i < 4 || (currentLarge >= 2 && currentLarge <= 3))
        );
        break;
        
      case 'consecutive':
        // åå¥½é€£è™Ÿ
        candidate = topCandidates.find(c => 
          !used.has(c.num) &&
          (selected.length === 0 || hasConsecutivePotential(selected, c.num))
        );
        break;
        
      default:
        candidate = topCandidates.find(c => !used.has(c.num));
    }
    
    if (candidate) {
      selected.push(candidate.num);
      used.add(candidate.num);
    } else {
      // å¦‚æœæ‰¾ä¸åˆ°åˆé©çš„ï¼Œé¸æ“‡åˆ†æ•¸æœ€é«˜çš„æœªä½¿ç”¨è™Ÿç¢¼
      for (let j = 1; j <= 39; j++) {
        if (!used.has(j)) {
          selected.push(j);
          used.add(j);
          break;
        }
      }
    }
  }
  
  return selected;
}

// æª¢æŸ¥æ˜¯å¦æœ‰é€£è™Ÿæ½›åŠ›
function hasConsecutivePotential(current, newNum) {
  for (const num of current) {
    if (Math.abs(num - newNum) <= 2) {
      return true;
    }
  }
  return false;
}

// é¡¯ç¤ºé æ¸¬çµæœ
function displayPrediction(numbers, strategy) {
  const container = document.getElementById('panelC');
  container.style.display = 'block';
  
  const stats = analysisCache;
  const score = evaluateCombination(numbers, stats);
  const rating = getRating(score);
  
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const largeCount = numbers.filter(n => n >= 20).length;
  const sum = numbers.reduce((a, b) => a + b, 0);
  const avg = (sum / 5).toFixed(1);
  
  document.getElementById('predictionResults').innerHTML = `
    <div class="box">
      <div class="box-title">ğŸ¯ ${strategy} çµæœ</div>
      
      <div class="numbers-grid">
        ${numbers.map(num => `
          <div class="number-ball selected">${num}</div>
        `).join('')}
      </div>
      
      <div class="status ${rating.status}">
        <strong>çµ„åˆè©•åˆ†: ${score}/100</strong><br>
        ${rating.description}
      </div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">ç­–ç•¥</div>
          <div class="stat-value">${strategy}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¤§å°</div>
          <div class="stat-value">${largeCount}å¤§${5-largeCount}å°</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
      </div>
      
      <div style="margin-top: 15px; text-align: center;">
        <div class="btn-group">
          <button class="btn" onclick="copyCombination('${numbers.join(' ')}')">
            ğŸ“‹ è¤‡è£½çµ„åˆ
          </button>
          <button class="btn" onclick="testCombination('${numbers.join(' ')}')">
            âœ… æ¸¬è©¦é©—è­‰
          </button>
        </div>
      </div>
    </div>
  `;
}

// éš¨æ©Ÿç”Ÿæˆçµ„åˆ
function generateRandomCombination() {
  const numbers = [];
  const used = new Set();
  
  while (numbers.length < 5) {
    const num = Math.floor(Math.random() * 39) + 1;
    if (!used.has(num)) {
      numbers.push(num);
      used.add(num);
    }
  }
  
  document.getElementById('verifyInput').value = numbers.sort((a, b) => a - b).join(' ');
  runVerify();
}

// æ¸…é™¤é©—è­‰
function clearVerification() {
  document.getElementById('verifyInput').value = '';
  document.getElementById('panelB').style.display = 'none';
}

// é¸æ“‡è™Ÿç¢¼
function selectNumber(num) {
  const ball = document.querySelector(`[data-number="${num}"]`);
  if (ball) {
    ball.classList.toggle('selected');
    
    // æ›´æ–°é©—è­‰è¼¸å…¥æ¡†
    const selected = Array.from(document.querySelectorAll('.number-ball.selected'))
      .map(el => {
        const num = el.getAttribute('data-number');
        return num ? parseInt(num) : null;
      })
      .filter(n => !isNaN(n));
    
    if (selected.length <= 5) {
      document.getElementById('verifyInput').value = selected.sort((a, b) => a - b).join(' ');
    }
  }
}

// é™„åŠ è™Ÿç¢¼é»æ“Šäº‹ä»¶
function attachNumberClickEvents() {
  document.querySelectorAll('.number-ball').forEach(ball => {
    ball.removeEventListener('click', handleNumberClick);
    ball.addEventListener('click', handleNumberClick);
  });
}

function handleNumberClick() {
  const num = parseInt(this.getAttribute('data-number'));
  if (!isNaN(num)) {
    selectNumber(num);
  }
}

// è¤‡è£½çµ„åˆ
function copyCombination(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('çµ„åˆå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
  }).catch(err => {
    console.error('è¤‡è£½å¤±æ•—:', err);
    alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
  });
}

// æ¸¬è©¦çµ„åˆ
function testCombination(text) {
  document.getElementById('verifyInput').value = text;
  runVerify();
}

// å·¥å…·å‡½æ•¸
function validateData() {
  if (!data || data.length === 0) {
    alert('è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶æˆ–ä½¿ç”¨ç¤ºä¾‹æ•¸æ“š');
    return false;
  }
  return true;
}

function validateCombination(numbers) {
  if (!numbers || numbers.length !== 5) {
    alert('è«‹è¼¸å…¥5å€‹è™Ÿç¢¼');
    return false;
  }
  
  if (new Set(numbers).size !== 5) {
    alert('è™Ÿç¢¼ä¸èƒ½é‡è¤‡');
    return false;
  }
  
  for (const num of numbers) {
    if (num < 1 || num > 39) {
      alert('è™Ÿç¢¼å¿…é ˆåœ¨1-39ä¹‹é–“');
      return false;
    }
  }
  
  return true;
}

function showStatus(elementId, message, type = 'info') {
  const element = document.getElementById(elementId);
  if (element) {
    element.innerHTML = `<div class="status ${type}">${message}</div>`;
  }
}

function showLoading(loadingId, show) {
  const element = document.getElementById(loadingId);
  if (element) {
    element.style.display = show ? 'block' : 'none';
  }
}

function animateProgress(progressId, duration) {
  const progress = document.getElementById(progressId);
  if (!progress) return;
  
  progress.style.width = '0%';
  
  let start = null;
  function step(timestamp) {
    if (!start) start = timestamp;
    const progressPercent = (timestamp - start) / duration * 100;
    progress.style.width = `${Math.min(progressPercent, 100)}%`;
    
    if (progressPercent < 100) {
      requestAnimationFrame(step);
    }
  }
  
  requestAnimationFrame(step);
}

// é¡¯ç¤ºåˆ†æçµæœ
function displayAnalysisResults() {
  const container = document.getElementById('panelA');
  if (container) {
    container.style.display = 'block';
    displayAnalysisTab(currentAnalysisTab);
  }
}
</script>
</body>
</html>
