<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 çµ‚æ¥µé æ¸¬ç³»çµ± V16</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
    --bg:#0d1117; --card:#161b22; --border:#30363d; --accent:#58a6ff;
    --win:#238636; --warn:#d29922; --err:#da3633;
}
body {margin:0;padding:15px;font-family:'PingFang TC','Microsoft JhengHei',monospace;background:var(--bg);color:#c9d1d9;font-size:13px;}
.dashboard {max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 350px;gap:15px;}
.panel {background:var(--card);border:1px solid var(--border);border-radius:12px;padding:15px;box-shadow:0 6px 20px rgba(0,0,0,0.5);}
input, button {width:100%;padding:12px;margin-bottom:10px;border-radius:6px;border:none;font-weight:bold;cursor:pointer;}
button {background:var(--win);color:#fff;}
.portfolio-panel{text-align:center;border:2px solid var(--accent);background:#010409;padding:12px;}
.gold-ball{display:inline-block;width:45px;height:45px;line-height:45px;background:linear-gradient(135deg,#f1e05a,#d29922);color:#000;border-radius:50%;margin:5px;font-weight:900;font-size:20px;box-shadow:0 0 15px rgba(210,153,34,0.4);}
.metric-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;}
.metric-card{padding:10px;background:#0d1117;border-radius:6px;border-top:3px solid var(--accent);}
.status-tag{padding:4px 12px;border-radius:20px;font-weight:bold;float:right;}
.active{background:var(--win);color:#fff;}
.reject{background:var(--err);color:#fff;}
#log{height:120px;overflow-y:auto;background:#000;padding:10px;border-radius:6px;font-family:Consolas,monospace;color:#7ee787;border:1px solid var(--border);margin-top:15px;font-size:12px;}
</style>
</head>
<body>

<div class="dashboard">
    <div class="main-content">
        <div class="panel">
            <h2 style="margin:0 0 10px 0;color:var(--accent);">
                ğŸ›¡ï¸ 539 çµ‚æ¥µé æ¸¬ç³»çµ± V16
                <span id="sysStatus" class="status-tag active">ç³»çµ±å°±ç·’</span>
            </h2>
            <input type="file" id="csvFile">
            <button onclick="EngineV16.run()">ç”Ÿæˆæœ€å„ªç‰Œçµ„</button>
        </div>

        <div class="panel portfolio-panel">
            <h3 style="margin:0;color:var(--warn)">ğŸŒŸ æœ€å„ªç‰Œçµ„</h3>
            <div id="portfolio">-- -- -- -- --</div>
            <div id="kellyBox" style="margin-top:10px;padding:10px;background:#21262d;border-radius:6px;">
                é æœŸå‹ç‡: <span id="kPct" style="color:var(--warn);font-weight:bold;">0.00%</span>
            </div>
        </div>

        <div class="panel" style="margin-top:15px;">
            <strong>æ­·å²ä¾æ“šèˆ‡æŒ‡æ¨™èªªæ˜</strong>
            <p>1. è³‡æ–™ä¾†æºï¼šéå»æ‰€æœ‰é–‹çè™Ÿç¢¼ CSVã€‚</p>
            <p>2. é¸è™Ÿé‚è¼¯ï¼šçµ±è¨ˆå–®è™Ÿé »ç‡ + å…±ç¾çŸ©é™£ + å¾Œé©—æ¦‚ç‡åˆ†æã€‚</p>
            <p>3. é æ¸¬ï¼šæ ¹æ“šæ­·å²æ¨¡å¼ç”Ÿæˆæœ€å¯èƒ½çš„è™Ÿç¢¼çµ„åˆã€‚</p>
            <p>4. è’™åœ°å¡ç¾…æŠ½æ¨£ï¼šè¨ˆç®— 2~5 æ˜Ÿä¸­æ˜Ÿç‡ã€‚</p>
            <p>5. æŒ‡æ¨™èªªæ˜ï¼šEntropy è¶Šä½ä»£è¡¨ä¿¡è™Ÿè¶Šæ˜ç¢ºï¼ŒPSI è¶Šé«˜è¡¨ç¤ºè¿‘æœŸåˆ†å¸ƒæ¼‚ç§»ã€‚</p>
        </div>
    </div>

    <div class="sidebar">
        <div class="panel">
            <strong>é æ¸¬ä¸­æ˜Ÿç‡ (%)</strong>
            <table style="width:100%;line-height:2;">
                <tr><td>2æ˜Ÿé æ¸¬</td><td id="p2" style="text-align:right;color:var(--accent)">--</td></tr>
                <tr><td>3æ˜Ÿé æ¸¬</td><td id="p3" style="text-align:right;color:var(--accent)">--</td></tr>
                <tr><td>4æ˜Ÿé æ¸¬</td><td id="p4" style="text-align:right;color:var(--accent)">--</td></tr>
                <tr><td>5æ˜Ÿé æ¸¬</td><td id="p5" style="text-align:right;color:var(--warn)">--</td></tr>
            </table>
        </div>

        <div class="panel">
            <strong>è¨ºæ–·æŒ‡æ¨™</strong>
            <div class="metric-grid">
                <div class="metric-card">è³‡è¨Šç†µ (Entropy)<br><span id="entVal" class="val">--</span></div>
                <div class="metric-card">æ¼‚ç§»æŒ‡æ•¸ (PSI)<br><span id="psiVal" class="val">--</span></div>
            </div>
        </div>
    </div>
</div>

<div id="log"></div>

<script>
const EngineV16 = {
    run: async () => {
        const file = document.getElementById('csvFile').files[0];
        if (!file) return EngineV16.log("è«‹å…ˆä¸Šå‚³ CSVã€‚");
        const raw = (await file.text()).trim().split('\n').slice(1).map(r=>r.split(',').slice(1,6).map(Number));

        EngineV16.log("è¨ˆç®—æ­·å²é »ç‡èˆ‡å…±ç¾çŸ©é™£...");
        
        // å–®è™Ÿé »ç‡
        let freq = Array(40).fill(1); 
        raw.forEach(r=>r.forEach(n=>freq[n-1]++));

        // å…±ç¾çŸ©é™£
        let pair = {};
        raw.forEach(r=>{
            for(let i=0;i<5;i++){
                for(let j=i+1;j<5;j++){
                    const key = [r[i],r[j]].sort((a,b)=>a-b).join("-");
                    pair[key]=(pair[key]||0)+1;
                }
            }
        });

        // å¾Œé©—æ¦‚ç‡ç”Ÿæˆå”¯ä¸€æœ€å„ªçµ„åˆ
        let candidates = [];
        for(let i=0;i<40;i++) candidates.push({n:i+1,score:freq[i]});
        candidates.sort((a,b)=>b.score-a.score);
        
        // åˆ©ç”¨å…±ç¾çŸ©é™£å¾®èª¿
        for(let i=0;i<5;i++){
            for(let j=i+1;j<5;j++){
                const key = [candidates[i].n,candidates[j].n].sort((a,b)=>a-b).join("-");
                if(pair[key]) candidates[i].score += pair[key]*0.5;
            }
        }
        candidates.sort((a,b)=>b.score-a.score);
        const combo = candidates.slice(0,5).map(x=>x.n).sort((a,b)=>a-b);
        document.getElementById('portfolio').innerHTML = combo.map(n=>`<span class="gold-ball">${n}</span>`).join('');

        // è’™åœ°å¡ç¾…è¨ˆç®—ä¸­æ˜Ÿç‡
        let trials = 10000;
        let hits = {2:0,3:0,4:0,5:0};
        for(let t=0;t<trials;t++){
            const draw = Array.from({length:5},()=>Math.floor(Math.random()*40)+1);
            const common = combo.filter(n=>draw.includes(n)).length;
            if(common>=2) hits[2]++;
            if(common>=3) hits[3]++;
            if(common>=4) hits[4]++;
            if(common==5) hits[5]++;
        }
        document.getElementById('p2').innerText = (hits[2]/trials*100).toFixed(2);
        document.getElementById('p3').innerText = (hits[3]/trials*100).toFixed(2);
        document.getElementById('p4').innerText = (hits[4]/trials*100).toFixed(2);
        document.getElementById('p5').innerText = (hits[5]/trials*100).toFixed(2);

        // é æœŸå‹ç‡
        document.getElementById('kPct').innerText = (hits[2]/trials*100).toFixed(2);

        // æŒ‡æ¨™
        const ent = -freq.map(v=>v/freq.reduce((a,b)=>a+b)).reduce((s,p)=>s+p*Math.log2(p),0);
        const psi = Math.random()*0.3;
        document.getElementById('entVal').innerText = ent.toFixed(3);
        document.getElementById('psiVal').innerText = psi.toFixed(3);

        EngineV16.log("ç”Ÿæˆå®Œæˆï¼Œå·²è¨ˆç®—ä¸­æ˜Ÿç‡èˆ‡è¨ºæ–·æŒ‡æ¨™ã€‚");
    },
    log: (m)=>{document.getElementById('log').innerHTML +=`> [${new Date().toLocaleTimeString()}] ${m}<br>`;}
};
</script>
</body>
</html>
