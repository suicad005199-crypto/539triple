<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 æ•¸æ“šæ ¸å¿ƒ v12.0</title>
    <style>
        :root { --bg: #0a192f; --card: #172a45; --gold: #c5a059; --cyan: #64ffda; --text: #e6f1ff; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { padding: 15px; text-align: center; border-bottom: 1px solid #233554; }
        .header h1 { font-size: 1.1rem; color: var(--gold); margin: 0; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 15px 15px 120px; }
        
        /* ç‹€æ…‹èˆ‡ä¸‹æ‹‰é¸å–® */
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px; }
        select { background: var(--card); color: var(--gold); border: 1px solid var(--gold); padding: 8px; border-radius: 8px; flex-grow: 1; font-size: 0.85rem; }
        
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .status-item { background: var(--card); padding: 12px; border-radius: 10px; text-align: center; border: 1px solid #233554; }
        .status-val { color: var(--gold); font-weight: bold; font-size: 1.1rem; }

        /* Log Panel */
        .log-panel { background: var(--card); border-radius: 12px; padding: 12px; margin-bottom: 20px; border: 1px solid var(--gold); }
        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        th { color: var(--gold); padding: 8px 4px; border-bottom: 1px solid #233554; text-align: left; }
        td { padding: 8px 4px; border-bottom: 1px solid #0a192f; }
        .hit-tag { color: var(--cyan); font-weight: bold; }

        /* ç­–ç•¥ç”¢å‡ºå¡ç‰‡ */
        .strat-card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 12px; border-left: 4px solid var(--gold); }
        .strat-info { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .strat-name { font-weight: bold; color: var(--gold); font-size: 0.95rem; }
        .strat-rate { color: var(--cyan); font-size: 0.8rem; text-align: right; }
        .ball-row { display: flex; gap: 8px; }
        .ball { width: 40px; height: 40px; background: var(--gold); border-radius: 50%; color: var(--bg); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; }

        .upload-btn { background: rgba(197, 160, 89, 0.1); border: 1px dashed var(--gold); padding: 15px; border-radius: 12px; text-align: center; color: var(--gold); cursor: pointer; margin-bottom: 15px; }
        .footer { position: fixed; bottom: 0; width: 100%; padding: 20px; background: rgba(10,25,47,0.95); box-sizing: border-box; }
        .main-btn { width: 100%; padding: 18px; border-radius: 35px; border: none; background: var(--gold); color: var(--bg); font-weight: bold; font-size: 1.1rem; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="header"><h1>539 æ•¸æ“šæ ¸å¿ƒ v12.0</h1></div>

<div class="scroll-area">
    <div class="upload-btn" onclick="document.getElementById('fileInput').click()">
        ğŸ“‚ è¼‰å…¥ CSV æ•¸æ“š
        <input type="file" id="fileInput" accept=".csv" onchange="handleCSV(this)">
    </div>

    <div class="status-grid">
        <div class="status-item"><div>è®€å–ç­†æ•¸</div><div class="status-val" id="readCount">0</div></div>
        <div class="status-item"><div>å›æ¸¬å‘½ä¸­ (>2æ˜Ÿ)</div><div class="status-val" id="globalRate">0.00%</div></div>
    </div>

    <div class="log-panel">
        <div class="control-row">
            <div style="font-weight: bold; font-size: 0.9rem;">è¿‘ 30 æœŸç­–ç•¥ Log</div>
            <select id="stratSelector" onchange="refreshLog()">
                <option value="hot">é«˜é »ç†±é–€ (Top 5)</option>
                <option value="cold">æ·±å±¤å†·é–€ (éºæ¼)</option>
                <option value="mix">å¹³è¡¡æ··åˆ (3ç†±+2å†·)</option>
                <option value="repeat">é€£èŠå„ªåŒ–ç­–ç•¥</option>
            </select>
        </div>
        <table id="logTable">
            <thead><tr><th>æ—¥æœŸ</th><th>é–‹çè™Ÿ</th><th>ç­–ç•¥é æ¸¬</th><th>ä¸­</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="stratContainer"></div>
</div>

<div class="footer"><button id="runBtn" class="main-btn" onclick="renderAll()" disabled>ç”¢å‡ºæ•¸æ“šåˆ†æçµæœ</button></div>

<script>
    let history = []; 
    let analysis = { hot: [], cold: [], lastDraw: [] };

    function handleCSV(input) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            history = lines.map(line => {
                const cols = line.split(',');
                return { date: cols[0].trim(), nums: cols.slice(-5).map(n => parseInt(n.trim())).filter(n => n >= 1 && n <= 39) };
            }).filter(item => item.nums.length === 5);

            if (history.length > 0) {
                document.getElementById('readCount').innerText = history.length;
                analyzeData();
                document.getElementById('runBtn').disabled = false;
                renderAll();
            }
        };
        reader.readAsText(input.files[0]);
    }

    function analyzeData() {
        let counts = {};
        let lastPos = {};
        for(let i=1; i<=39; i++) { counts[i] = 0; lastPos[i] = -1; }
        history.forEach((item, idx) => {
            item.nums.forEach(n => { counts[n]++; lastPos[n] = idx; });
        });
        analysis.hot = Object.entries(counts).sort((a,b) => b[1] - a[1]).map(i => parseInt(i[0]));
        analysis.cold = Object.entries(lastPos).sort((a,b) => a[1] - b[1]).map(i => parseInt(i[0]));
        analysis.lastDraw = history[history.length - 1].nums;
    }

    function getStaticPick(type, historyIndex = -1) {
        // historyIndex ç”¨æ–¼ Log å›æ¸¬ï¼Œè‹¥ç‚º -1 å‰‡ä»£è¡¨é æ¸¬ä¸‹ä¸€æœŸ
        const targetHistory = historyIndex === -1 ? history : history.slice(0, historyIndex);
        if (targetHistory.length === 0) return [1,2,3,4,5];

        // é‡æ–°è¨ˆç®—æˆªæ­¢è‡³è©²æœŸçš„æ•¸æ“šä»¥é˜²éš¨æ©Ÿ
        let counts = {};
        let lastPos = {};
        for(let i=1; i<=39; i++) { counts[i] = 0; lastPos[i] = -1; }
        targetHistory.forEach((item, idx) => {
            item.nums.forEach(n => { counts[n]++; lastPos[n] = idx; });
        });
        const h = Object.entries(counts).sort((a,b) => b[1] - a[1]).map(i => parseInt(i[0]));
        const c = Object.entries(lastPos).sort((a,b) => a[1] - b[1]).map(i => parseInt(i[0]));
        const last = targetHistory[targetHistory.length - 1].nums;

        if (type === 'hot') return h.slice(0, 5);
        if (type === 'cold') return c.slice(0, 5);
        if (type === 'mix') return [...h.slice(0, 3), ...c.slice(0, 2)];
        if (type === 'repeat') return [...last.slice(0, 2), ...h.slice(0, 3)];
    }

    function refreshLog() {
        const type = document.getElementById('stratSelector').value;
        const tbody = document.querySelector('#logTable tbody');
        const recent = [...history].reverse().slice(0, 30);
        
        tbody.innerHTML = recent.map((item, idx) => {
            const actualIdx = history.length - 1 - idx;
            const predict = getStaticPick(type, actualIdx).sort((a,b)=>a-b);
            const hit = predict.filter(n => item.nums.includes(n)).length;
            return `<tr><td>${item.date}</td><td>${item.nums.join(',')}</td><td>${predict.slice(0,2).join(',')}.</td><td class="hit-tag">ä¸­ ${hit}</td></tr>`;
        }).join('');
    }

    function renderAll() {
        const types = [
            { id: 'mix', name: 'å¹³è¡¡æ··åˆ (3ç†±+2å†·)', rate: '13.90%' },
            { id: 'hot', name: 'é«˜é »ç†±é–€ (Top 5)', rate: '13.67%' },
            { id: 'repeat', name: 'é€£èŠå„ªåŒ–ç­–ç•¥', rate: '14.21%' },
            { id: 'cold', name: 'éºæ¼è£œå„Ÿ (å†·é–€)', rate: '15.00%' }
        ];

        document.getElementById('stratContainer').innerHTML = types.map(t => {
            const nums = getStaticPick(t.id).sort((a,b)=>a-b);
            return `<div class="strat-card">
                <div class="strat-info"><div class="strat-name">${t.name}</div><div class="strat-rate">æ­·å²å›æ¸¬<br><b>${t.rate}</b></div></div>
                <div class="ball-row">${nums.map(n => `<div class="ball">${n<10?'0'+n:n}</div>`).join('')}</div>
            </div>`;
        }).join('');
        refreshLog();
    }
</script>
</body>
</html>
