<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>539 æ™ºèƒ½åˆ†æç³»çµ± - Pro é‡åŒ–æ±ºç­–ç‰ˆ</title>
<style>
    :root {
        --primary: #0f172a; --secondary: #1e293b; --accent: #38bdf8;
        --gold: #fbbf24; --success: #22c55e; --error: #ef4444;
        --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7); --text: #f1f5f9;
        --glass: rgba(255, 255, 255, 0.03);
    }
    body { 
        font-family: 'PingFang TC', sans-serif; background-color: var(--bg);
        background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
        margin: 0; padding: 20px 15px; color: var(--text); min-height: 100vh;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 30px; }
    header h1 { font-size: 2.2rem; color: var(--accent); margin: 0; letter-spacing: 2px; }
    .card { 
        background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08);
        padding: 24px; border-radius: 24px; margin-bottom: 25px;
    }
    
    /* Scroll View å®¹å™¨ */
    .scroll-view {
        max-height: 450px; 
        overflow-y: auto;
        padding-right: 8px;
        margin-top: 15px;
    }
    /* å®¢è£½åŒ–æ²è»¸ */
    .scroll-view::-webkit-scrollbar { width: 5px; }
    .scroll-view::-webkit-scrollbar-track { background: transparent; }
    .scroll-view::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

    .upload-section { border: 2px dashed rgba(56, 189, 248, 0.2); text-align: center; padding: 40px 20px; }
    button { 
        background: linear-gradient(135deg, var(--accent), #0284c7); color: white; border: none; 
        padding: 16px; border-radius: 14px; font-weight: 800; cursor: pointer; width: 100%;
    }
    .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    @media (min-width: 768px) { .dashboard-grid { grid-template-columns: 1.3fr 0.7fr; } }
    
    .ball { 
        display: inline-block; width: 34px; height: 34px; line-height: 34px; text-align: center; 
        border-radius: 50%; background: radial-gradient(circle at 30% 30%, #475569, #1e293b);
        margin: 2px; font-weight: 800; color: var(--accent); font-size: 14px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    table { width: 100%; border-collapse: collapse; }
    td { padding: 10px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: center; }
    .strategy-block { background: var(--glass); padding: 15px; margin: 10px 0; border-radius: 15px; border-left: 4px solid var(--accent); }
    .cold-tag { background: rgba(239, 68, 68, 0.15); color: var(--error); padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; }
</style>
</head>
<body>

<div class="container">
    <header><h1>539 QUANT PRO</h1><p>å·²å„ªåŒ–ï¼šé™å†ªé¡¯ç¤º â€¢ æ»¾å‹•è¦–çª—</p></header>

    <div class="card upload-section">
        <input type="file" id="csvFile" accept=".csv" style="display: none;">
        <label for="csvFile" id="fileLabel" style="display: block; padding: 20px; background: var(--secondary); border-radius: 10px; cursor: pointer; margin-bottom: 20px; color: #94a3b8; border: 1px solid rgba(255,255,255,0.1);">
            é»æ“Šé¸å–æ­·å²æ•¸æ“š CSV
        </label>
        <button onclick="runAll()">è®€å–ä¸¦æ›´æ–°æ•¸æ“š</button>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h3 style="margin-top:0; color:var(--gold);">ğŸ“… æ­·å²é–‹çç´€éŒ„ (æœ€æ–°å„ªå…ˆ)</h3>
            <div id="history" class="scroll-view">
                <div style="text-align: center; opacity: 0.3; padding: 40px;">ç­‰å¾…æ•¸æ“šè®€å–...</div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0; color:var(--gold);">âš ï¸ æ¥µå†·è™Ÿçµ±è¨ˆ</h3>
            <div id="coldList" style="display: flex; flex-direction: column; gap: 12px;">
                <div style="text-align: center; opacity: 0.3;">ç­‰å¾…è¨ˆç®—...</div>
            </div>
        </div>
    </div>

    <div id="results" class="card">
        <h3 style="margin-top:0; color:var(--gold);">æ™ºèƒ½é‡åŒ–æ¨è–¦</h3>
        <div class="content" style="text-align: center; opacity: 0.3;">ç­‰å¾…æ•¸æ“šå°å…¥...</div>
    </div>
</div>

<script>
let HIST_DATA = [];

function parseCSV(text) {
    const lines = text.trim().split(/\r?\n/);
    // æª¢æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦ç‚ºæ¨™é¡Œ (åˆ¤æ–·æ˜¯å¦å«é€—è™Ÿæˆ–éæ•¸å­—)
    if (isNaN(parseInt(lines[0].split(',')[1]))) lines.shift(); 
    
    // ç›´æ¥è§£æï¼Œä¸é€²è¡Œé¡å¤–æ’åº (ç¶­æŒ CSV åŸå§‹é †åºï¼šæ–° -> èˆŠ)
    return lines.map(l => {
        const p = l.split(",");
        if (p.length < 6) return null;
        const nums = p.slice(1, 6).map(n => parseInt(n.trim())).filter(n => !isNaN(n)).sort((a,b)=>a-b);
        return { date: p[0].trim(), nums };
    }).filter(x => x !== null);
}

function showHistory(data) {
    let html = "<table>";
    data.forEach(d => {
        html += `<tr>
            <td style="font-size:12px;color:#94a3b8;width:90px;text-align:left;">${d.date}</td>
            <td style="text-align:left;">${d.nums.map(n=>`<span class="ball">${String(n).padStart(2,'0')}</span>`).join('')}</td>
        </tr>`;
    });
    document.getElementById("history").innerHTML = html + "</table>";
}

function updateColdRankUI(data) {
    const map = {};
    for(let i=1; i<=39; i++) {
        // å› æ•¸æ“šç”±æ–°åˆ°èˆŠï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€å€‹ç´¢å¼•å³ç‚ºéºæ¼æœŸæ•¸
        const lastIdx = data.findIndex(d => d.nums.includes(i));
        map[i] = (lastIdx === -1) ? data.length : lastIdx;
    }

    const sorted = Object.entries(map).sort((a,b) => b[1] - a[1]).slice(0, 5);
    document.getElementById("coldList").innerHTML = sorted.map(item => `
        <div style="display:flex; align-items:center; justify-content: space-between; background:rgba(255,255,255,0.03); padding:8px 12px; border-radius:12px; border: 1px solid rgba(255,255,255,0.05);">
            <div class="ball" style="border:1px solid var(--error); width:30px; height:30px; line-height:30px; font-size:13px;">${String(item[0]).padStart(2,'0')}</div>
            <div class="cold-tag">${item[1]} æœŸæœªé–‹</div>
        </div>`).join("");
}

function generateRecommendations(data) {
    // ç°¡æ˜“æ¬Šé‡ï¼šå–æœ€è¿‘ 30 æœŸå‡ºç¾é »ç‡æœ€é«˜çš„
    const sample = data.slice(0, 30);
    const freq = {};
    sample.forEach(d => d.nums.forEach(n => freq[n] = (freq[n] || 0) + 1));
    const hotOnes = Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0, 5).map(x=>x[0]);

    document.querySelector("#results .content").innerHTML = `
        <div class="strategy-block">
            <strong>ğŸ”¥ è¿‘ 30 æœŸé«˜é »ç‡è™Ÿç¢¼</strong><br>
            <div style="margin-top:10px;">
                ${hotOnes.map(n => `<span class="ball" style="background:radial-gradient(circle at 30% 30%, #38bdf8, #0284c7); color:white;">${String(n).padStart(2,'0')}</span>`).join('')}
            </div>
            <p style="font-size:12px; color:#94a3b8; margin-top:10px;">åŸºæ–¼ CSV é ‚ç«¯æœ€è¿‘æ•¸æ“šåˆ†æå¾—å‡º</p>
        </div>`;
}

async function runAll() {
    const fileInput = document.getElementById("csvFile");
    if(!fileInput.files[0]) return alert("è«‹å…ˆé¸å– CSV æª”æ¡ˆ");
    
    try {
        const text = await fileInput.files[0].text();
        HIST_DATA = parseCSV(text);
        
        if(HIST_DATA.length === 0) {
            alert("æ•¸æ“šè§£æå¤±æ•—ï¼Œè«‹ç¢ºèªå…§å®¹æ ¼å¼æ˜¯å¦æ­£ç¢º");
            return;
        }

        showHistory(HIST_DATA);
        updateColdRankUI(HIST_DATA);
        generateRecommendations(HIST_DATA);
        
    } catch (e) {
        alert("è®€å–æª”æ¡ˆç™¼ç”ŸéŒ¯èª¤");
    }
}

document.getElementById('csvFile').addEventListener('change', e => {
    document.getElementById('fileLabel').innerText = e.target.files[0] ? e.target.files[0].name : "é»æ“Šé¸å–æ­·å²æ•¸æ“š CSV";
});
</script>
</body>
</html>
