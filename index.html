<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI 預測系統 - iOS 優化版</title>
    
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-bg: #F2F2F7;
            --ios-card: #FFFFFF;
            --predict-gold: #FFF9E6;
            --hit-red: #FF3B30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--ios-bg);
            margin: 0;
            padding: 15px 15px 100px 15px; /* 底部留白避免遮擋 */
            color: #000;
        }

        /* 卡片式設計 */
        .panel {
            background: var(--ios-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 14px;
            font-weight: 600;
            color: #8E8E93;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        /* 單手操作優化：上傳按鈕 */
        .upload-wrapper {
            display: flex;
            justify-content: center;
        }
        input[type="file"] {
            font-size: 16px; /* 防止 iOS 自動放大 */
            width: 100%;
            padding: 10px;
        }

        /* Panel 2 預測號碼 */
        #bestNumbers {
            font-size: 24px;
            font-weight: 700;
            color: var(--hit-red);
            text-align: center;
            letter-spacing: 2px;
        }

        /* 表格通用設定 */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* iOS 滑動優化 */
        }

        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 13px;
        }

        th, td {
            border-bottom: 0.5px solid #E5E5EA;
            padding: 10px 4px;
            text-align: center;
        }

        th { background-color: #F8F8F8; color: #3A3A3C; font-weight: 600; }

        .predict-row { background-color: var(--predict-gold); }

        /* Panel 4 分布圖專用 */
        .num-cell {
            min-width: 24px;
            font-size: 10px;
            color: #C7C7CC;
        }
        .hit {
            background-color: #FFCC00;
            color: #000;
            font-weight: bold;
            border-radius: 4px;
        }

        /* 底部操作列 (單手模式) */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 0.5px solid #A7A7AA;
            padding: 10px 20px;
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }
    </style>
</head>
<body>

    <div class="panel" id="p1">
        <span class="panel-title">Panel 1: 資料來源</span>
        <div class="upload-wrapper">
            <input type="file" id="csvFile" accept=".csv">
        </div>
    </div>

    <div class="panel" id="p2">
        <span class="panel-title">Panel 2: 下期精準預測</span>
        <div id="bestNumbers">---</div>
    </div>

    <div class="panel" id="p3">
        <span class="panel-title">Panel 3: 歷史資料</span>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>日期</th>
                        <th>開獎</th>
                        <th>預測</th>
                        <th>命中</th>
                    </tr>
                </thead>
                <tbody id="p3Body"></tbody>
            </table>
        </div>
    </div>

    <div class="panel" id="p4">
        <span class="panel-title">Panel 4: 1-39 號碼分佈圖</span>
        <div class="table-container">
            <table>
                <thead>
                    <tr id="distHeader"><th>日期</th></tr>
                </thead>
                <tbody id="p4Body"></tbody>
            </table>
        </div>
    </div>

    <script>
        // 初始化標題
        const header = document.getElementById('distHeader');
        for (let i = 1; i <= 39; i++) {
            let th = document.createElement('th');
            th.innerText = i;
            th.className = 'num-cell';
            header.appendChild(th);
        }

        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => processData(ev.target.result);
            reader.readAsText(file, "UTF-8");
        });

        function generate8() {
            let res = [];
            while(res.length < 8) {
                let r = Math.floor(Math.random() * 39) + 1;
                let s = r.toString().padStart(2, '0');
                if(!res.includes(s)) res.push(s);
            }
            return res.sort();
        }

        function processData(csv) {
            let rows = csv.trim().split(/\r?\n/)
                .map(l => l.split(',').map(c => c.trim().replace(/"/g, '')))
                .filter(c => !isNaN(Date.parse(c[0])) && !c[0].includes("日期"));

            if (rows.length === 0) return;

            // 1. 日期計算
            const dates = rows.map(r => new Date(r[0]));
            const maxD = new Date(Math.max.apply(null, dates));
            let nextD = new Date(maxD);
            nextD.setDate(nextD.getDate() + 1);
            const nextStr = nextD.toISOString().split('T')[0];

            // 2. 預測
            const predArr = generate8();
            const predStr = predArr.join(' ');
            document.getElementById('bestNumbers').innerText = predStr;

            // 3. 排序與渲染
            rows.sort((a, b) => new Date(b[0]) - new Date(a[0]));
            
            let p3h = `<tr class="predict-row"><td>${nextStr}</td><td>待開</td><td style="color:red">${predStr}</td><td>-</td></tr>`;
            let p4h = `<tr class="predict-row"><td>${nextStr}</td>${'<td></td>'.repeat(39)}</tr>`;

            rows.forEach(r => {
                const d = r[0];
                const nums = r.slice(1).map(n => n.padStart(2, '0'));
                
                p3h += `<tr><td>${d}</td><td>${nums.join(' ')}</td><td>-</td><td>-</td></tr>`;

                let cells = "";
                for(let i=1; i<=39; i++) {
                    let cur = i.toString().padStart(2, '0');
                    let isHit = nums.includes(cur);
                    cells += `<td class="num-cell ${isHit ? 'hit' : ''}">${isHit ? i : ''}</td>`;
                }
                p4h += `<tr><td>${d}</td>${cells}</tr>`;
            });

            document.getElementById('p3Body').innerHTML = p3h;
            document.getElementById('p4Body').innerHTML = p4h;
        }
    </script>
</body>
</html>
