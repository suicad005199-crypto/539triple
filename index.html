<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>必中 v3 Stable</title>

<style>
:root{
  --bg:#0b1626;
  --panel:#142b4d;
  --primary:#00ff99;
  --hot:#ff6666;
  --cold:#4fc3f7;
  --warn:#ffcc00;
  --text:#e0f7ff;
}
body{
  margin:0;
  background:linear-gradient(135deg,#050b15,#0b1626);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
}
.container{max-width:900px;margin:auto;padding:20px}
.panel{
  background:var(--panel);
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
}
.panel h2{
  margin:0 0 15px;
  color:var(--primary);
}
input,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}
button{
  background:linear-gradient(135deg,#274c77,#1a3a5f);
  color:#fff;
  cursor:pointer;
}
button.primary{background:linear-gradient(135deg,#00ff99,#00cc7a)}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(48px,1fr));
  gap:8px;
}
.ball{
  height:48px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  background:#274c77;
}
.ball.hot{background:var(--hot)}
.ball.cold{background:var(--cold)}
.ball.warn{background:var(--warn);color:#000}
.box{margin-top:15px}
.status{font-size:.9rem;margin-top:10px;color:#8da1b9}
hr{border:none;border-top:1px solid rgba(255,255,255,.1);margin:15px 0}
</style>
</head>

<body>
<div class="container">

<!-- Panel 1 -->
<div class="panel">
  <h2>1️⃣ 資料載入</h2>
  <input type="file" id="csvInput" accept=".csv"/>
  <div id="csvStatus" class="status"></div>
</div>

<!-- Panel 2 -->
<div class="panel">
  <h2>2️⃣ 冷 / 熱號</h2>
  <div id="hotCold"></div>
</div>

<!-- Panel 3 -->
<div class="panel">
  <h2>3️⃣ 遺漏 / 連開</h2>
  <div id="missRepeat"></div>
</div>

<!-- Panel 4 -->
<div class="panel">
  <h2>4️⃣ 連號分布</h2>
  <div id="consecutive"></div>
</div>

<!-- Panel 5 -->
<div class="panel">
  <h2>5️⃣ 模擬預測（3 組）</h2>
  <button class="primary" onclick="generate()">產生預測</button>
  <div id="prediction"></div>
</div>

</div>

<script>
/* ===== 資料層 ===== */
let draws=[];

document.getElementById('csvInput').addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file)return;
  const r=new FileReader();
  r.onload=()=>{
    draws=[];
    r.result.trim().split(/\r?\n/).slice(1).forEach(l=>{
      const p=l.split(',').map(x=>x.trim());
      const nums=p.slice(1,6).map(Number);
      if(nums.every(n=>n>=1&&n<=39))draws.push(nums);
    });
    document.getElementById('csvStatus').innerText=
      `已載入 ${draws.length} 期`;
    analyze();
  };
  r.readAsText(file);
});

/* ===== 分析核心 ===== */
function analyze(){
  const freq={},last={},repeat={},consCount={};
  draws.forEach((d,i)=>{
    d.forEach(n=>{
      freq[n]=(freq[n]||0)+1;
      last[n]=i;
    });
    for(let j=0;j<4;j++){
      if(d[j+1]===d[j]+1)
        consCount[d[j]]=(consCount[d[j]]||0)+1;
    }
  });

  // 熱冷
  const sorted=[...Array(39)].map((_,i)=>i+1)
    .sort((a,b)=>(freq[b]||0)-(freq[a]||0));
  renderBalls('hotCold',
    sorted.slice(0,10),'hot',
    sorted.slice(-10),'cold'
  );

  // 遺漏
  const miss=[...Array(39)].map((_,i)=>i+1)
    .sort((a,b)=>(draws.length-(last[b]||0))-(draws.length-(last[a]||0)))
    .slice(0,10);
  document.getElementById('missRepeat').innerHTML=
    `<div class="grid">${miss.map(n=>`<div class="ball warn">${n}</div>`).join('')}</div>`;

  // 連號
  document.getElementById('consecutive').innerHTML=
    `<div class="status">歷史連號出現位置：${Object.keys(consCount).length} 種</div>`;
}

/* ===== UI 小工具 ===== */
function renderBalls(id,a,ca,b,cb){
  document.getElementById(id).innerHTML=
    `<div class="grid">
      ${a.map(n=>`<div class="ball ${ca}">${n}</div>`).join('')}
      ${b.map(n=>`<div class="ball ${cb}">${n}</div>`).join('')}
     </div>`;
}

/* ===== 預測引擎 ===== */
function generate(){
  if(!draws.length)return alert('請先載入資料');
  const freq={},last={};
  draws.forEach((d,i)=>d.forEach(n=>{
    freq[n]=(freq[n]||0)+1;
    last[n]=i;
  }));

  const pool=[...Array(39)].map((_,i)=>{
    const n=i+1;
    const f=(freq[n]||0)/draws.length;
    const m=draws.length-(last[n]||0);
    let s=0;
    if(f>0.05&&f<0.12)s+=30;
    if(m>10)s+=m;
    return {n,s};
  }).sort((a,b)=>b.s-a.s);

  const sets=[];
  for(let k=0;k<3;k++){
    const sel=[];
    while(sel.length<5){
      const c=pool[Math.floor(Math.random()*15)].n;
      if(!sel.includes(c))sel.push(c);
    }
    sets.push(sel.sort((a,b)=>a-b));
  }

  document.getElementById('prediction').innerHTML=
    sets.map(s=>`
      <div class="box">
        <div class="grid">
          ${s.map(n=>`<div class="ball hot">${n}</div>`).join('')}
        </div>
      </div>`).join('');
}
</script>
</body>
</html>
