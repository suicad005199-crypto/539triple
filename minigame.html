<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 智慧量化決策系統 v2.0</title>
    <style>
        :root { 
            --bg: #f2f2f7; --card: #ffffff; --primary: #1c1c1e; 
            --gold: #ffcc00; --red: #ff3b30; --green: #34c759; --blue: #007aff;
            --gray: #8e8e93;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: var(--card); padding: 25px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); }
        
        /* 新增：手動更新區域 */
        .admin-panel { background: #eee; border-radius: 15px; padding: 15px; margin-bottom: 20px; display: none; }
        .admin-panel input { width: 70%; padding: 8px; border-radius: 8px; border: 1px solid #ccc; }
        .admin-toggle { font-size: 12px; color: var(--blue); cursor: pointer; text-align: right; margin-bottom: 10px; }

        .header { text-align: center; margin-bottom: 20px; }
        .main-title { font-size: 26px; font-weight: 800; }
        .btn-generate { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 18px; font-size: 18px; font-weight: 700; cursor: pointer; }
        .set-card { background: white; border: 1.5px solid #eee; border-radius: 20px; padding: 18px; margin-top: 15px; }
        .ball-row { display: flex; gap: 8px; }
        .ball { width: 38px; height: 38px; background: #f2f2f7; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        .hot-ball { background: var(--gold); }
        
        /* 彈窗樣式略... (保持上一版) */
    </style>
</head>
<body>

<div class="container">
    <div class="admin-toggle" onclick="toggleAdmin()">⚙️ 數據管理</div>
    <div class="admin-panel" id="adminPanel">
        <small>新增開獎 (格式: 01,02,03,04,05)</small><br>
        <input type="text" id="newNums" placeholder="例如: 11,22,33,04,15">
        <button onclick="addData()">存檔</button>
        <button onclick="clearData()" style="color:red">清空數據</button>
    </div>

    <div class="header">
        <h1 class="main-title">539 量化決策系統</h1>
        <div id="statInfo" style="font-size:12px; color:gray"></div>
    </div>

    <button class="btn-generate" onclick="generateSmartSets()">開始智能運算</button>
    <div id="resultsArea"></div>
</div>

<script>
    // 預設歷史數據
    const defaultHistory = [
        { id: "115009", nums: [11, 25, 26, 34, 38] },
        { id: "115008", nums: [01, 12, 14, 22, 34] },
        { id: "115007", nums: [03, 08, 10, 21, 30] },
        { id: "115006", nums: [05, 10, 14, 15, 28] },
        { id: "115005", nums: [01, 02, 06, 11, 33] }
    ];

    // 從本地瀏覽器讀取數據，如果沒有就用預設的
    let realHistory = JSON.parse(localStorage.getItem('my539Data')) || defaultHistory;

    function toggleAdmin() {
        const p = document.getElementById('adminPanel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function addData() {
        const val = document.getElementById('newNums').value;
        const arr = val.split(',').map(n => parseInt(n.trim()));
        if(arr.length !== 5) return alert("請輸入5個數字，用逗號隔開");
        
        realHistory.unshift({ id: Date.now().toString().slice(-6), nums: arr });
        localStorage.setItem('my539Data', JSON.stringify(realHistory));
        alert("數據已同步！系統已重新學習最新趨勢。");
        location.reload();
    }

    function clearData() {
        if(confirm("確定要恢復預設數據嗎？")) {
            localStorage.removeItem('my539Data');
            location.reload();
        }
    }

    // 更新統計資訊
    function updateStats() {
        const freqMap = {};
        realHistory.forEach(d => d.nums.forEach(n => freqMap[n] = (freqMap[n] || 0) + 1));
        const hots = Object.keys(freqMap).filter(k => freqMap[k] >= 2);
        document.getElementById('statInfo').innerText = `已分析 ${realHistory.length} 期數據 | 當前熱點: ${hots.join(', ')}`;
    }
    updateStats();

    // (此處接續之前的 generateSmartSets 與 calculateOneSet 函數內容...)
    // ... 
</script>
</body>
</html>